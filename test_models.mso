using "mbo_streams";
using "PID";
using "mixers_splitters";
using "pressure_changers";
using "thermal_changers";
using "separators";

FlowSheet test_PID
	VARIABLES
out	PV			as pressure (DisplayUnit='kPa');
	PIT			as pressure_transmitter;
	PIC_pos		as PID_pos;
	PIC_incr		as PID_incr;

	CONNECTIONS
	PV			to PIT.PVinput;

	PIT.PVoutput	to PIC_pos.PV;
	PIT.SPoutput	to PIC_pos.SP;

	PIT.PVoutput	to PIC_incr.PV;
	PIT.SPoutput	to PIC_incr.SP;

	SET
	PIT.RangeMax = 3000*'kPa';
	PIT.RangeMin = 0*'kPa';
	PIC_pos.action = "Direct";
	PIC_incr.action = "Direct";

	SPECIFY
	PIT.SPinput = 1500*'kPa';

	PIC_pos.KC = 1;
	PIC_pos.TI = 60*'s';
	PIC_pos.TD = 0*'s';

	PIC_incr.KC = 1;
	PIC_incr.TI = 60*'s';
	PIC_incr.TD = 0*'s';
	
	EQUATIONS
	PV = 1500*'kPa'*(1+0.1*sin((2*time/'min' + 3.14159/2)*'rad'));

	PIC_pos.mode = 0.5*(1+tanh((time/'s'-120)/1e-6));
	PIC_pos.MVinput = 0.5*(1+tanh((120-time/'s')/1e-6))*PIC_pos.MVoutput
		+ 0.5*(1+tanh((time/'s'-120)/1e-6))*0.5;

	PIC_incr.mode = 0.5*(1+tanh((time/'s'-180)/1e-6));
	PIC_incr.MVinput = 0.5*(1+tanh((180-time/'s')/1e-6))*PIC_incr.MVoutput
		+ 0.5*(1+tanh((time/'s'-180)/1e-6))*0.5;

	INITIAL
	PIC_pos.MVoutput = 0.5;
	PIC_incr.MVoutput = 0.5;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeEnd = 300;
	TimeUnit = 's';
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_stream
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	
	VARIABLES
	triph_source	as triphase_source;
	biph_source	as biphase_source;
	l_source 		as liquid_source;
	c_source 		as condensate_source;
	gl_source 	as gasliq_source;
	g_source		as gas_source;
	w_source		as water_source;

	triph_sink	as triphase_sink;
	biph_sink		as biphase_sink;
	l_sink		as liquid_sink;
	c_sink		as condensate_sink;
	gl_sink		as gasliq_sink;
	g_sink		as gas_sink;
	w_sink		as water_sink;

	CONNECTIONS
	triph_source.Outlet		to	triph_sink.Inlet;
	biph_source.Outlet		to	biph_sink.Inlet;
	l_source.Outlet		to	l_sink.Inlet;
	c_source.Outlet		to	c_sink.Inlet;
	gl_source.Outlet		to	gl_sink.Inlet;
	g_source.Outlet		to	g_sink.Inlet;
	w_source.Outlet		to	w_sink.Inlet;
	
	SPECIFY
	triph_source.Outlet.Qf = 24000 * 'm^3/d';
	triph_source.Rgo = 200 * 'm^3/m^3';
	triph_source.Outlet.BSW = 0.2;
	triph_source.Outlet.P = (2000+101.325) * 'kPa';
	triph_source.Outlet.T = (40 + 273.15) *'K';
	triph_source.Outlet.ws = (112*'g/l'/rho_H2Ostd)/(1 + (112*'g/l'/rho_H2Ostd));
	triph_source.Outlet.d60 = 141.5/(29+131.5);
	triph_source.Outlet.Tbn = (11.3*triph_source.Outlet.d60)^3 * 'degR';
	triph_source.Outlet.dg = 0.7;
	triph_source.Outlet.Ycg = 4*'l/m^3';

	biph_source.Outlet.Qf = 1035.43 * 'm^3/d';
	biph_source.Outlet.Qg = 20834.5 * 'm^3/d';
	biph_source.Outlet.P = 941.358 * 'kPa';
	biph_source.Outlet.T = 288.879 *'K';
	biph_source.Outlet.d60 = 0.930033;
	biph_source.Outlet.Tbn = 646.186  * 'K';
	biph_source.Outlet.dg = 1.74442;
	biph_source.Outlet.Ycg = 14.8571*'l/m^3';

	l_source.Outlet.Qf = 24000 * 'm^3/d';
	l_source.Outlet.P = (700+101.325) * 'kPa';
	l_source.Outlet.T = (40 + 273.15) * 'K';
	l_source.Outlet.BSW = 0.2;
	l_source.Outlet.ws = (112*'g/l'/rho_H2Ostd)/(1 + (112*'g/l'/rho_H2Ostd));
	l_source.Outlet.d60 = 141.5/(29+131.5);
	l_source.Outlet.Tbn = (10.5*l_source.Outlet.d60)^3 * 'degR';
	l_source.Outlet.dg = 1.05;
	l_source.Outlet.Ycg = 5.5*'l/m^3';

	c_source.Outlet.Qf = 1600 * 'm^3/d';
	c_source.Outlet.P = (700+101.325) * 'kPa';
	c_source.Outlet.T = 312.316 * 'K';
	c_source.Outlet.d60 = 0.8017;
	c_source.Outlet.Tbn = 331.383 * 'K';
	c_source.Outlet.dg = 0.9;
	c_source.Outlet.Ycg = 4*'l/m^3';

	gl_source.Outlet.Qg = 6e6 * 'm^3/d';
	gl_source.Rcg = 0.005 * 'l/m^3';
	gl_source.Outlet.P = (5000+101.325) * 'kPa';
	gl_source.Outlet.T = (10 + 273.15) * 'K';
	gl_source.API = 29;
	gl_source.Kw = 10.5;
	gl_source.Outlet.dg = 0.7;
	gl_source.Outlet.Ycg = 4*'l/m^3';

	g_source.Outlet.Qg = 6e6 * 'm^3/d';
	g_source.Outlet.P = (5000+101.325) * 'kPa';
	g_source.Outlet.T = (10 + 273.15) * 'K';
	g_source.Outlet.d60 = 141.5/(29+131.5);
	g_source.Outlet.Tbn = (10.5*g_source.Outlet.d60)^3 * 'degR';
	g_source.Outlet.dg = 0.7;
	g_source.Outlet.Ycg = 4*'l/m^3';

	w_source.Outlet.Qw = 50 * 'm^3/h';
	w_source.Outlet.TOG = 0.00 * 'ml/m^3';
	w_source.Outlet.P = (200+101.325) * 'kPa';
	w_source.Outlet.T = (90 + 273.15) * 'K';
	w_source.Outlet.ws = (5*'g/l'/rho_H2Ostd)/(1 + (5*'g/l'/rho_H2Ostd));
	w_source.Outlet.d60 = 141.5/(29+131.5);
	w_source.Outlet.Tbn = (11.3*w_source.Outlet.d60)^3 * 'degR';
	
	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_degasser
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	gas			as gas_sink;
	liq			as liquid_sink;

	V_TO_001 		as degasser;
	
	PIT_002		as pressure_transmitter;
	PIC_002		as PID_pos;

	LIT_003		as level_transmitter;
	LIC_003		as PID_pos;
	
	CONNECTIONS
	feed.Outlet			to V_TO_001.Inlet;
	V_TO_001.OutletG		to gas.Inlet;
	V_TO_001.OutletL		to liq.Inlet;
	
	V_TO_001.OutletG.P		to PIT_002.PVinput;
	PIT_002.PVoutput		to PIC_002.PV;
	PIT_002.SPoutput		to PIC_002.SP;

	V_TO_001.Level			to LIT_003.PVinput;
	LIT_003.PVoutput		to LIC_003.PV;
	LIT_003.SPoutput		to LIC_003.SP;
	
	SET
#DEGASSER PARAMETERS
	V_TO_001.L = 8 * 'm';
	V_TO_001.D = 2.5 * 'm';

#DEGASSER PRESSURE CONTROLLER
	PIT_002.RangeMax = 1500*'kPa';
	PIT_002.RangeMin = 0*'kPa';
	PIC_002.action = "Direct";	

#DEGASSER LIQUID LEVEL CONTROLLER
	LIT_003.RangeMax = 2.5*'m';
	LIT_003.RangeMin = 0*'m';
	LIC_003.action = "Direct";

	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.Qf = 22000 * 'm^3/d';
	feed.Outlet.BSW = 0.20;
	feed.Rgo = 5 * 'm^3/m^3';
	feed.Outlet.T = (90+273.15) * 'K';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.Outlet.d60 = 141.5/(30+131.5);
	feed.Outlet.Tbn = (11.8*feed.Outlet.d60)^3 * 'degR';
	feed.Outlet.dg = 1.05;
	feed.Outlet.Ycg = 5.5*'l/m^3';
	
#DEGASSER PRESSURE CONTROLLER
	PIT_002.SPinput = 700*'kPa' + Patm;
	PIC_002.KC = 1;
	PIC_002.TI = 600*'s';
	PIC_002.TD = 0*'s';
	PIC_002.mode = 0; #Auto
	PIC_002.MVinput = PIC_002.MVoutput;

#DEGASSER LEVEL CONTROLLER
	LIT_003.SPinput = 1.0*'m';
	LIC_003.KC = 1;
	LIC_003.TI = 600*'s';
	LIC_003.TD = 0*'s';
	LIC_003.mode = 0; #Auto
	LIC_003.MVinput = LIC_003.MVoutput;

#SPECIAL CONDIDTIONS
	gas.Inlet.Qg = PIC_002.MVoutput*5e5*'m^3/d';
	liq.Inlet.Qf = LIC_003.MVoutput*30000*'m^3/d';

#	EQUATIONS
#	feed.Outlet.T = (90+273.15)*'K' * 
#		(1 - 0.1*0.5*(1+tanh((time/'min'-60)/1e-6)));

	INITIAL
	"Degasser initial conditions"
	V_TO_001.OutletG.P = 700*'kPa' + Patm;
	V_TO_001.OutletG.T = (80+273.15)*'K';
	V_TO_001.OutletL.BSW = 0.15;
	V_TO_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	V_TO_001.OutletL.d60 = 141.5/(35+131.5);
	V_TO_001.OutletL.Tbn = (12.1*V_TO_001.OutletL.d60)^3*'degR';
	V_TO_001.OutletG.dg = 0.95;
	V_TO_001.OutletG.Ycg = 4.5*'l/m^3';
	V_TO_001.Level = 1.5*'m';

	PIC_002.MVoutput = 88/500;
	LIC_003.MVoutput = 22/30;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 120;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_gasliq_separator_001
#The objective of this FlowSheet is to show the mass-balance and energy-balance 
#consistency of the scrubber_gasliq.mso model."
	
	PARAMETERS
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);

	DEVICES
	feed			as gasliq_source;
	gas			as gas_sink;
	liq			as condensate_sink;

	sep			as gasliq_separator;

	PIT			as pressure_transmitter;
	PIC			as PID_pos;

	LIT			as level_transmitter;
	LIC			as PID_pos;
	
	CONNECTIONS
	feed.Outlet		to sep.Inlet;
	sep.OutletG		to gas.Inlet;
	sep.OutletL		to liq.Inlet;

	sep.OutletG.P		to PIT.PVinput;
	PIT.PVoutput		to PIC.PV;
	PIT.SPoutput		to PIC.SP;

	sep.Level			to LIT.PVinput;
	LIT.PVoutput		to LIC.PV;
	LIT.SPoutput		to LIC.SP;

	SET
#SCRUBBER PARAMETERS
	sep.H = 3 * 'm';
	sep.D = 1.25 * 'm';	

#SCRUBBER PRESSURE CONTROLLER
	PIT.RangeMax = 3000*'kPa';
	PIT.RangeMin = 0*'kPa';
	PIC.action = "Direct";	

#SCRUBBER LIQUID LEVEL CONTROLLER
	LIT.RangeMax = 3*'m';
	LIT.RangeMin = 0*'m';
	LIC.action = "Direct";

	SPECIFY
	feed.Outlet.Qg = 2.5e5 * 'm^3/d';
	feed.Rcg = 0.0 * 'l/m^3';
	feed.Outlet.T = (40+273.15) * 'K';
	feed.Outlet.d60G = 141.5/(70+131.5);
	feed.Outlet.TbnG = (9.083*feed.Outlet.d60G)^3 * 'degR';
	feed.Outlet.dg = 0.65;
	feed.Outlet.Ycg = 2*'l/m^3';

#DEGASSER PRESSURE CONTROLLER
	PIT.SPinput = 2000*'kPa' + Patm;
	PIC.KC = 4;
	PIC.TI = 600*'s';
	PIC.TD = 0*'s';
	PIC.mode = 0; #Auto
	PIC.MVinput = PIC.MVoutput;

#DEGASSER LEVEL CONTROLLER
	LIT.SPinput = 0.75 *'m';
	LIC.KC = 4;
	LIC.TI = 600*'s';
	LIC.TD = 0*'s';
	LIC.mode = 0; #Auto
	LIC.MVinput = LIC.MVoutput;

#SPECIAL CONDIDTIONS
	gas.Inlet.Qg = PIC.MVoutput*1e6*'m^3/d';
	liq.Inlet.Qf = LIC.MVoutput*1000*'m^3/d';
	
#	EQUATIONS
#	if time < 30*'min' then
#		feed.Outlet.T = (40+273.15) * 'K';
#		side.Outlet.T = (40+273.15) * 'K';
#		surge.Outlet.T = (40+273.15) * 'K';
#		InletL.Outlet.T = (40+273.15) * 'K';
#	else
#		feed.Outlet.T = (35+273.15) * 'K';
#		side.Outlet.T = (35+273.15) * 'K';
#		surge.Outlet.T = (35+273.15) * 'K';
#		InletL.Outlet.T = (35+273.15) * 'K';
#	end

	INITIAL
	sep.OutletG.P = 2000 * 'kPa' + Patm;
	sep.OutletG.T = (50+273.15)*'K';
	sep.Level = 0.75*'m';
	sep.OutletG.dg = 0.65;
	sep.OutletG.Ycg = 2*'l/m^3';
	sep.OutletG.d60G = 141.5/(70+131.5);
	sep.OutletG.TbnG = (9.083*sep.OutletG.d60G)^3 * 'degR';

	PIC.MVoutput = 85/100;
#	LIC.MVoutput = 50/100;
	LIC.MVoutput = 0/100;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 180;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_gasliq_separator_002
#The objective of this FlowSheet is to show the enthalpy mixture effect on mass and energy balances
#models considering dg, Tbn, d60 and Ycg acting as global composition variables."
	
	PARAMETERS
	Patm		as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);

	DEVICES
	feed		as gasliq_source;
	sep		as gasliq_separator;

	PIT		as pressure_transmitter;
	PIC		as PID_pos;

	LIT		as level_transmitter;
	LIC		as PID_pos;

	CONNECTIONS
	feed.Outlet		to	sep.Inlet;

	sep.OutletG.P		to 	PIT.PVinput;
	PIT.PVoutput		to 	PIC.PV;
	PIT.SPoutput		to 	PIC.SP;

	sep.Level			to 	LIT.PVinput;
	LIT.PVoutput		to 	LIC.PV;
	LIT.SPoutput		to 	LIC.SP;

	SET
	sep.H = 6.125 * 'm';
	sep.D = 2.5 * 'm';	

#SCRUBBER PRESSURE CONTROLLER
	PIT.RangeMax = 3000*'kPa';
	PIT.RangeMin = 0*'kPa';
	PIC.action = "Direct";	

#SCRUBBER LIQUID LEVEL CONTROLLER
	LIT.RangeMax = 3*'m';
	LIT.RangeMin = 0*'m';
	LIC.action = "Direct";

	SPECIFY
	feed.Outlet.Qg = 2e6 * 'm^3/d';
	feed.Rcg = 0.0 * 'l/m^3';
	feed.Outlet.T = (40+273.15) * 'K';
	feed.Outlet.d60G = 0.719452;
	feed.Outlet.TbnG = 162.46*'K';
	feed.Outlet.dg = 0.711229;
	feed.Outlet.Ycg = 4.03282*'l/m^3';

	PIT.SPinput = 2000*'kPa' + Patm;
	PIC.KC = 4;
	PIC.TI = 600*'s';
	PIC.TD = 0*'s';
	PIC.mode = 0; #Auto
	PIC.MVinput = PIC.MVoutput;

	LIT.SPinput = 0.75 *'m';
	LIC.KC = 4;
	LIC.TI = 600*'s';
	LIC.TD = 0*'s';
	LIC.mode = 0; #Auto
	LIC.MVinput = LIC.MVoutput;

#SPECIAL CONDIDTIONS
	sep.OutletG.Qg = PIC.MVoutput*3e6*'m^3/d';
	sep.OutletL.Qf = LIC.MVoutput*2000*'m^3/d';

	INITIAL
	sep.OutletG.P = 2000 * 'kPa' + Patm;
	sep.OutletG.T = (40+273.15)*'K';
	sep.Level = 0.75*'m';
	sep.OutletG.dg = 0.7;
	sep.OutletG.Ycg = 4*'l/m^3';
	sep.OutletL.d60 = 141.5/(70+131.5);
	sep.OutletL.Tbn = (11.1*sep.OutletL.d60)^3 * 'degR';

	PIC.MVoutput = 2/3;
	LIC.MVoutput = 5/20;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 60;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_scrubber_gasliq_001
#The objective of this FlowSheet is to show the mass-balance and energy-balance 
#consistency of the scrubber_gasliq.mso model."
	
	PARAMETERS
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);

	DEVICES
	feed			as gasliq_source;
	surge		as gasliq_source;
	InletL		as biphase_source;
	gas			as gas_sink;
#	liq			as condensate_sink;

	scrb			as scrubber_gasliq;

	PIT			as pressure_transmitter;
	PIC			as PID_pos;

	LIT			as level_transmitter;
	LIC			as PID_pos;
	
	CONNECTIONS
	feed.Outlet		to scrb.InletG;
	surge.Outlet		to scrb.InletSurge;
	InletL.Outlet		to scrb.InletL;

	scrb.OutletG		to gas.Inlet;
#	scrb.OutletL		to liq.Inlet;

	scrb.OutletG.P		to PIT.PVinput;
	PIT.PVoutput		to PIC.PV;
	PIT.SPoutput		to PIC.SP;

	scrb.Level		to LIT.PVinput;
	LIT.PVoutput		to LIC.PV;
	LIT.SPoutput		to LIC.SP;

	SET
#SCRUBBER PARAMETERS
	scrb.H = 3 * 'm';
	scrb.D = 1.25 * 'm';	

#SCRUBBER PRESSURE CONTROLLER
	PIT.RangeMax = 3000*'kPa';
	PIT.RangeMin = 0*'kPa';
	PIC.action = "Direct";	

#SCRUBBER LIQUID LEVEL CONTROLLER
	LIT.RangeMax = 3*'m';
	LIT.RangeMin = 0*'m';
	LIC.action = "Direct";

	SPECIFY
	feed.Outlet.Qg = 2.5e5 * 'm^3/d';
	feed.Rcg = 0.0 * 'l/m^3';
	feed.Outlet.T = (40+273.15) * 'K';
	feed.Outlet.d60G = 141.5/(70+131.5);
	feed.Outlet.TbnG = (9.083*feed.Outlet.d60G)^3 * 'degR';
	feed.Outlet.dg = 0.65;
	feed.Outlet.Ycg = 2*'l/m^3';

	surge.Outlet.Qg = 1e5 * 'm^3/d';
	surge.Rcg = 0.0 * 'l/m^3';
	surge.Outlet.T = (40+273.15) * 'K';
	surge.Outlet.d60G = 141.5/(70+131.5);
	surge.Outlet.TbnG = (9.083*surge.Outlet.d60G)^3 * 'degR';
	surge.Outlet.dg = 0.65;
	surge.Outlet.Ycg = 2*'l/m^3';
	
	InletL.Outlet.Qf = 100 * 'm^3/d';
	InletL.Rgo = 0.0 * 'm^3/m^3';
	InletL.Outlet.T = (40+273.15) * 'K';
	InletL.Outlet.d60G = 141.5/(70+131.5);
#	InletL.Kw = 11.29994323;
	InletL.Kw = 9.083;
	InletL.Outlet.dg = 0.65;
	InletL.Outlet.Ycg = 2*'l/m^3';

#	InletL.Outlet.P = feed.Outlet.P;

#DEGASSER PRESSURE CONTROLLER
	PIT.SPinput = 2000*'kPa' + Patm;
	PIC.KC = 4;
	PIC.TI = 600*'s';
	PIC.TD = 0*'s';
	PIC.mode = 0; #Auto
	PIC.MVinput = PIC.MVoutput;

#DEGASSER LEVEL CONTROLLER
	LIT.SPinput = 0.75 *'m';
	LIC.KC = 4;
	LIC.TI = 600*'s';
	LIC.TD = 0*'s';
	LIC.mode = 0; #Auto
	LIC.MVinput = LIC.MVoutput;

#SPECIAL CONDIDTIONS
	gas.Inlet.Qg = PIC.MVoutput*1e6*'m^3/d';
#	liq.Inlet.Qf = LIC.MVoutput*1000*'m^3/d';
	scrb.OutletL.Qf = LIC.MVoutput*2000*'m^3/d';
	
#	EQUATIONS
#	if time < 30*'min' then
#		feed.Outlet.T = (40+273.15) * 'K';
#		side.Outlet.T = (40+273.15) * 'K';
#		surge.Outlet.T = (40+273.15) * 'K';
#		InletL.Outlet.T = (40+273.15) * 'K';
#	else
#		feed.Outlet.T = (35+273.15) * 'K';
#		side.Outlet.T = (35+273.15) * 'K';
#		surge.Outlet.T = (35+273.15) * 'K';
#		InletL.Outlet.T = (35+273.15) * 'K';
#	end

	INITIAL
	scrb.OutletG.P = 2000 * 'kPa' + Patm;
	scrb.OutletG.T = (50+273.15)*'K';
	scrb.Level = 0.75*'m';
	scrb.OutletG.dg = 0.65;
	scrb.OutletG.Ycg = 2*'l/m^3';
	scrb.OutletG.d60G = 141.5/(70+131.5);
	scrb.OutletG.TbnG = (9.083*scrb.OutletG.d60G)^3 * 'degR';

	PIC.MVoutput = 85/100;
#	LIC.MVoutput = 50/100;
	LIC.MVoutput = 0/100;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 180;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_scrubber_gasliq_002
#The objective of this FlowSheet is to show the enthalpy mixture effect on mass and energy balances
#models considering dg, Tbn, d60 and Ycg acting as global composition variables."
	
	PARAMETERS
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);

	DEVICES
	feed			as gasliq_source;
	surge		as gasliq_source;
	InletL		as biphase_source;
	scrb			as scrubber_gasliq;

	PIT			as pressure_transmitter;
	PIC			as PID_pos;

	LIT			as level_transmitter;
	LIC			as PID_pos;

	CONNECTIONS
	feed.Outlet		to	scrb.InletG;
	surge.Outlet		to	scrb.InletSurge;
	InletL.Outlet		to	scrb.InletL;

	scrb.OutletG.P		to PIT.PVinput;
	PIT.PVoutput		to PIC.PV;
	PIT.SPoutput		to PIC.SP;

	scrb.Level		to LIT.PVinput;
	LIT.PVoutput		to LIC.PV;
	LIT.SPoutput		to LIC.SP;

	SET
	scrb.H = 6.125 * 'm';
	scrb.D = 2.5 * 'm';	

#SCRUBBER PRESSURE CONTROLLER
	PIT.RangeMax = 3000*'kPa';
	PIT.RangeMin = 0*'kPa';
	PIC.action = "Direct";	

#SCRUBBER LIQUID LEVEL CONTROLLER
	LIT.RangeMax = 3*'m';
	LIT.RangeMin = 0*'m';
	LIC.action = "Direct";

	SPECIFY
	feed.Outlet.Qg = 2e6 * 'm^3/d';
	feed.Rcg = 0.0 * 'l/m^3';
	feed.Outlet.T = (40+273.15) * 'K';
	feed.Outlet.d60G = 0.719452;
	feed.Outlet.TbnG = 162.46*'K';
	feed.Outlet.dg = 0.711229;
	feed.Outlet.Ycg = 4.03282*'l/m^3';

	surge.Outlet.Qg = 0.0 * 'm^3/d';
	surge.Rcg = 0.0 * 'l/m^3';
	surge.Outlet.T = (40+273.15) * 'K';
	surge.Outlet.d60G = 0.785769;
	surge.Outlet.TbnG = 211.654*'K';
	surge.Outlet.dg = 0.712005;
	surge.Outlet.Ycg = 4.03722*'l/m^3';
	
	InletL.Outlet.Qf = 578.986 * 'm^3/d';
	InletL.Outlet.Qg = 12793.0 * 'm^3/d';
	InletL.Outlet.T = 310.192 * 'K';
	InletL.Outlet.d60 = 1.03356;
	InletL.Outlet.Tbn = 481.664*'K';
	InletL.Outlet.dg = 0.739534;
	InletL.Outlet.Ycg = 4.19331*'l/m^3';

	PIT.SPinput = 2000*'kPa' + Patm;
	PIC.KC = 4;
	PIC.TI = 600*'s';
	PIC.TD = 0*'s';
	PIC.mode = 0; #Auto
	PIC.MVinput = PIC.MVoutput;

	LIT.SPinput = 0.75 *'m';
	LIC.KC = 4;
	LIC.TI = 600*'s';
	LIC.TD = 0*'s';
	LIC.mode = 0; #Auto
	LIC.MVinput = LIC.MVoutput;

#SPECIAL CONDIDTIONS
	scrb.OutletG.Qg = PIC.MVoutput*3e6*'m^3/d';
#	liq.Inlet.Qf = LIC.MVoutput*1000*'m^3/d';
	scrb.OutletL.Qf = LIC.MVoutput*2000*'m^3/d';

#	EQUATIONS
#	diff(scrb.VG*scrb.OutletG.dg) = 0*'m^3/s';
#	scrb.OutletG.P = 2000 * 'kPa' + Patm;	
#	diff(scrb.VLstd*scrb.OutletL.d60) = 0*'m^3/s';

	INITIAL
	scrb.OutletG.P = 2000 * 'kPa' + Patm;
	scrb.OutletG.T = (40+273.15)*'K';
	scrb.Level = 0.75*'m';
	scrb.OutletG.dg = 0.7;
	scrb.OutletG.Ycg = 4*'l/m^3';
	scrb.OutletL.d60 = 141.5/(70+131.5);
	scrb.OutletL.Tbn = (11.1*scrb.OutletL.d60)^3 * 'degR';

	PIC.MVoutput = 2/3;
#	LIC.MVoutput = 50/100;
	LIC.MVoutput = 5/20;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 60;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_scrubber_gas_001
#The objective of this FlowSheet is to show the mass-balance and energy-balance 
#consistency of the scrubber_gas.mso model."
	
	PARAMETERS
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);

	DEVICES
	feed			as gas_source;
	surge		as gas_source;
	scrb			as scrubber_gas;
	
	CONNECTIONS
	feed.Outlet	to	scrb.InletG;
	surge.Outlet	to	scrb.InletSurge;
	
	SET
	scrb.H = 3 * 'm';
	scrb.D = 1.25 * 'm';	

	SPECIFY
	feed.Outlet.Qg = 2.5e5 * 'm^3/d';
	feed.Outlet.T = (40+273.15) * 'K';
	feed.API = 70;
	feed.Kw = 11.1;
	feed.Outlet.dg = 0.7;
	feed.Outlet.Ycg = 4*'l/m^3';

	surge.Outlet.Qg = 1e5 * 'm^3/d';
	surge.Outlet.T = (40+273.15) * 'K';
	surge.API = 70;
	surge.Kw = 11.1;
	surge.Outlet.dg = 0.7;
	surge.Outlet.Ycg = 4*'l/m^3';

	EQUATIONS
	diff(scrb.VGstd) = 0*'m^3/s';

	INITIAL
	scrb.OutletG.P = 2000 * 'kPa' + Patm;
	scrb.OutletG.T = (40+273.15)*'K';
	scrb.OutletG.Rv = 0.001*'l/m^3' ;
	scrb.OutletG.d60G = 141.5/(70+131.5);
	scrb.OutletG.TbnG = (11.1*scrb.OutletG.d60G)^3 * 'degR';
	scrb.OutletG.dg = 0.7;
	scrb.OutletG.Ycg = 4*'l/m^3';
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 60;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_triseparator
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	liq			as liquid_sink;
	gas			as gas_sink;
	water		as water_sink;
	
	SG_001 		as triphase_separator;
	
	PIT_001		as pressure_transmitter;
	PIC_001		as PID_pos;
	
	LIT_001		as level_transmitter;
	LIC_001		as PID_pos;
	
	LIT_002		as level_transmitter;
	LIC_002		as PID_pos;
	
	CONNECTIONS
	feed.Outlet		to SG_001.Inlet;
	SG_001.OutletG		to gas.Inlet;
	SG_001.OutletL		to liq.Inlet;
	SG_001.OutletW		to water.Inlet;
	
	SG_001.OutletG.P	to PIT_001.PVinput;
	PIT_001.PVoutput	to PIC_001.PV;
	PIT_001.SPoutput	to PIC_001.SP;

	SG_001.LevelCL		to LIT_001.PVinput;
	LIT_001.PVoutput	to LIC_001.PV;
	LIT_001.SPoutput	to LIC_001.SP;

	SG_001.LevelWCS	to LIT_002.PVinput;
	LIT_002.PVoutput	to LIC_002.PV;
	LIT_002.SPoutput	to LIC_002.SP;
	
	SET
#TRISEPARATOR PARAMETERS
	SG_001.hweir = 2.5 * 'm';
	SG_001.LCS = 16.0 * 'm';
	SG_001.LCL = 4.0 * 'm';
	SG_001.D = 5.0 * 'm';

#TRISEPARATOR PRESSURE CONTROLLER
	PIT_001.RangeMax = 3000*'kPa';
	PIT_001.RangeMin = 0*'kPa';
	PIC_001.action = "Direct";	

#TRISEPARATOR OIL LEVEL CONTROLLER
	LIT_001.RangeMax = 3*'m';
	LIT_001.RangeMin = 0*'m';
	LIC_001.action = "Direct";

#TRISEPARATOR WATER LEVEL CONTROLLER
	LIT_002.RangeMax = 3*'m';
	LIT_002.RangeMin = 0*'m';
	LIC_002.action = "Direct";


	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.T = (40+273.15) * 'K';
	feed.Outlet.BSW = 0.40;
	feed.Rgo = 200 * 'm^3/m^3';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.Outlet.d60 = 141.5/(29+131.5);
	feed.Outlet.Tbn = (11.3*feed.Outlet.d60)^3*'degR';
	feed.Outlet.dg = 0.7;
	feed.Outlet.Ycg = 4*'l/m^3';
	
#TRISEPARATOR VESSEL PRESSURE CONTROLLER
	PIT_001.SPinput = 2000*'kPa' + Patm;
	PIC_001.KC = 4;
	PIC_001.TI = 600*'s';
	PIC_001.TD = 0*'s';
	PIC_001.mode = 0; #Auto
	PIC_001.MVinput = PIC_001.MVoutput;

#TRISEPARATOR OIL LEVEL CONTROLLER
	LIT_001.SPinput = 1.5*'m';
	LIC_001.KC = 4;
	LIC_001.TI = 600*'s';
	LIC_001.TD = 0*'s';
	LIC_001.mode = 0; #Auto
	LIC_001.MVinput = LIC_001.MVoutput;

#TRISEPARATOR WATER LEVEL CONTROLLER
	LIC_002.KC = 4;
	LIC_002.TI = 600*'s';
	LIC_002.TD = 0*'s';
	LIC_002.mode = 0; #Auto
	LIC_002.MVinput = LIC_002.MVoutput;

#SPECIAL CONDIDTIONS
	SG_001.OutletG.Qg = PIC_001.MVoutput*6e6*'m^3/d';
	SG_001.OutletL.Qf = LIC_001.MVoutput*24000*'m^3/d';
	SG_001.OutletW.Qw = LIC_002.MVoutput*20000*'m^3/d';
	
	EQUATIONS
	"Water level set-point step disturb"
	LIT_002.SPinput = 0.75*'m';
#	LIT_002.SPinput = 0.75*'m' + 0.5*'m'*0.5*(1+tanh((time/'min'-180)/1e-6));

	"Feed liquid std vol. flow step disturb"
	feed.Outlet.Qf = 24000*'m^3/d';
#	feed.Outlet.Qf = 24000*'m^3/d'*(1-0.1*0.5*(1+tanh((time/'min'-180)/1e-6)));
	
	INITIAL
	SG_001.OutletG.P = 2000* 'kPa' + Patm;
	SG_001.OutletG.T = (40+273.15)*'K';
	SG_001.OutletL.d60 = 141.5/(29+131.5);
	SG_001.OutletL.Tbn = (11.3*SG_001.OutletL.d60)^3*'degR';
	SG_001.OutletG.dg = 0.7;
	SG_001.OutletG.Ycg = 4*'l/m^3';
	SG_001.OutletW.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	SG_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	SG_001.BSWLCS = 0.40;
	SG_001.OutletL.BSW = 0.40;
	SG_001.LevelWCS = 0.75*'m';
	SG_001.LevelCS = 1.001*SG_001.hweir;
	SG_001.LevelCL = 1.5*'m';

	PIC_001.MVoutput = 24000*200/6e6;
	LIC_001.MVoutput = (1-0.4);
	LIC_002.MVoutput = 24000*0.4/20000;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 180;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_oil_treater
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as liquid_source;
	liq			as liquid_sink;
	water		as water_sink;
	
	TO_001	 	as oil_treater;

	LIT_004		as level_transmitter;
	LIC_004		as PID_pos;
	
	CONNECTIONS
	feed.Outlet			to TO_001.Inlet;
	
	TO_001.OutletL		to liq.Inlet;
	TO_001.OutletW		to water.Inlet;

	TO_001.LevelW		to LIT_004.PVinput;
	LIT_004.PVoutput	to LIC_004.PV;
	LIT_004.SPoutput	to LIC_004.SP;
	
	SET
#OIL TREATER PARAMETERS
	TO_001.L = 15.0 * 'm';
	TO_001.D = 4.0 * 'm';
	TO_001.TRL50 = 210*'s';
	TO_001.b = 3.6;

#OIL TREATER WATER LEVEL CONTROLLER
	LIT_004.RangeMax = 4*'m';
	LIT_004.RangeMin = 0*'m';
	LIC_004.action = "Direct";
	
	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.Qf = 22000*'m^3/d';
	feed.Outlet.BSW = 0.40;
	feed.Outlet.P = 700* 'kPa' + Patm;	
	feed.Outlet.T = (90+273.15) * 'K';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.Outlet.d60 = 141.5/(30+131.5);
	feed.Outlet.Tbn = (11.8*feed.Outlet.d60)^3 * 'degR';
	feed.Outlet.dg = 1.05;
	feed.Outlet.Ycg = 5.5*'l/m^3';

#OIL TREATER WATER LEVEL CONTROLLER
	LIT_004.SPinput = 2.0*'m';
	LIC_004.KC = 4;
	LIC_004.TI = 600*'s';
	LIC_004.TD = 0*'s';
	LIC_004.mode = 0; #Auto
	LIC_004.MVinput = LIC_004.MVoutput;

#SPECIAL CONDITIONS
#	liq.Inlet.Qf = 22000*'m^3/d';
	water.Inlet.Qw = LIC_004.MVoutput*20000*'m^3/d';
	
	INITIAL
	"Oil treater initial conditions"
	TO_001.OutletW.T = (80+273.15)*'K';
	TO_001.OutletL.d60 = 141.5/(35+131.5);
	TO_001.OutletL.Tbn = (12.1*TO_001.OutletL.d60)^3 * 'degR';
	TO_001.OutletW.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	TO_001.LevelW = 1.5*'m';
	
	LIC_004.MVoutput = 22*0.4/20;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 180;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_degasser_oil_treater
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	gas			as gas_sink;
	liq			as liquid_sink;
	water		as water_sink;
	
	V_TO_001 		as degasser;
	TO_001	 	as oil_treater;

	PIT_002		as pressure_transmitter;
	PIC_002		as PID_pos;

	LIT_003		as level_transmitter;
	LIC_003		as PID_pos;

	LIT_004		as level_transmitter;
	LIC_004		as PID_pos;
	
	CONNECTIONS
	feed.Outlet			to V_TO_001.Inlet;
	V_TO_001.OutletL		to TO_001.Inlet;
	
	V_TO_001.OutletG		to gas.Inlet;
	TO_001.OutletL			to liq.Inlet;
	TO_001.OutletW			to water.Inlet;

	V_TO_001.OutletG.P		to PIT_002.PVinput;
	PIT_002.PVoutput		to PIC_002.PV;
	PIT_002.SPoutput		to PIC_002.SP;

	V_TO_001.Level			to LIT_003.PVinput;
	LIT_003.PVoutput		to LIC_003.PV;
	LIT_003.SPoutput		to LIC_003.SP;

	TO_001.LevelW			to LIT_004.PVinput;
	LIT_004.PVoutput		to LIC_004.PV;
	LIT_004.SPoutput		to LIC_004.SP;
	
	SET
#DEGASSER PARAMETERS
	V_TO_001.L = 8 * 'm';
	V_TO_001.D = 2.5 * 'm';
	
#OIL TREATER PARAMETERS
	TO_001.L = 15.0 * 'm';
	TO_001.D = 4.0 * 'm';
	TO_001.TRL50 = 210*'s';
	TO_001.b = 3.6;

#DEGASSER PRESSURE CONTROLLER
	PIT_002.RangeMax = 1500*'kPa';
	PIT_002.RangeMin = 0*'kPa';
	PIC_002.action = "Direct";	

#DEGASSER OIL LEVEL CONTROLLER
	LIT_003.RangeMax = 2.5*'m';
	LIT_003.RangeMin = 0*'m';
	LIC_003.action = "Direct";

#OIL TREATER WATER LEVEL CONTROLLER
	LIT_004.RangeMax = 4*'m';
	LIT_004.RangeMin = 0*'m';
	LIC_004.action = "Direct";
	
	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.Qf = 22000 * 'm^3/d';
	feed.Outlet.BSW = 0.40;
	feed.Rgo = 5 * 'm^3/m^3';
	feed.Outlet.T = (90+273.15) * 'K';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.Outlet.d60 = 141.5/(30+131.5);
	feed.Outlet.Tbn = (11.8*feed.Outlet.d60)^3 * 'degR';
	feed.Outlet.dg = 1.05;
	feed.Outlet.Ycg = 5.5*'l/m^3';

#DEGASSER PRESSURE CONTROLLER
	PIT_002.SPinput = 700*'kPa' + Patm;
	PIC_002.KC = 1;
	PIC_002.TI = 600*'s';
	PIC_002.TD = 0*'s';
	PIC_002.mode = 0; #Auto
	PIC_002.MVinput = PIC_002.MVoutput;

#DEGASSER OIL LEVEL CONTROLLER
	LIT_003.SPinput = 1.0*'m';
	LIC_003.KC = 4;
	LIC_003.TI = 600*'s';
	LIC_003.TD = 0*'s';
	LIC_003.mode = 0; #Auto
	LIC_003.MVinput = LIC_003.MVoutput;

#OIL TREATER WATER LEVEL CONTROLLER
	LIT_004.SPinput = 2.0*'m';
	LIC_004.KC = 4;
	LIC_004.TI = 600*'s';
	LIC_004.TD = 0*'s';
	LIC_004.mode = 0; #Auto
	LIC_004.MVinput = LIC_004.MVoutput;

#SPECIAL CONDITIONS
	gas.Inlet.Qg = PIC_002.MVoutput*5e5*'m^3/d';
	liq.Inlet.Qf = LIC_003.MVoutput*30000*'m^3/d';
	water.Inlet.Qw = LIC_004.MVoutput*20000*'m^3/d';
	
	INITIAL
	"Degasser initial conditions"
	V_TO_001.OutletG.P = 700*'kPa' + Patm;
	V_TO_001.OutletG.T = (80+273.15)*'K';
	V_TO_001.OutletL.BSW = 0.15;
	V_TO_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	V_TO_001.OutletL.d60 = 141.5/(35+131.5);
	V_TO_001.OutletL.Tbn = (12.1*V_TO_001.OutletL.d60)^3*'degR';
	V_TO_001.OutletG.dg = 0.95;
	V_TO_001.OutletG.Ycg = 4.5*'l/m^3';
	V_TO_001.Level = 1.5*'m';
	
	"Oil treater initial conditions"
	TO_001.OutletW.T = (80+273.15)*'K';
	TO_001.OutletL.d60 = 141.5/(35+131.5);
	TO_001.OutletL.Tbn = (12.1*feed.Outlet.d60)^3 * 'degR';
	TO_001.OutletW.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	TO_001.LevelW = 1.5*'m';
	
	PIC_002.MVoutput = 88/500;
	LIC_003.MVoutput = 22/30;
	LIC_004.MVoutput = 22*0.4/20;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 180;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_valv_liq
	DEVICES
	l_source 		as liquid_source;
	valv			as valv_liq;
	l_sink		as triphase_sink;

	VARIABLES
	bal 			as Real;

	CONNECTIONS
	l_source.Outlet	to	valv.Inlet;
	valv.Outlet		to	l_sink.Inlet;
	
	SET
#	valv.Cv = 1000*'gal/min';
	valv.Cv = 60*'gal/min';

	valv.FL = 0.91;
	
	SPECIFY
	l_source.Outlet.P = (2000+101.325) * 'kPa';
	l_source.Outlet.T = (40 + 273.15) * 'K';
	l_source.Outlet.BSW = 0.0;
	l_source.Outlet.ws = 0.0;
	l_source.Outlet.d60 = 141.5/(45+131.5);
	l_source.Outlet.Tbn = (10.5*l_source.Outlet.d60)^3 * 'degR';
	l_source.Outlet.dg = 0.9;
	l_source.Outlet.Ycg = 4*'l/m^3';
	
	valv.c = 0.8;
	valv.Outlet.P = (700+101.325) * 'kPa';

#	l_source.Outlet.P = (2000+101.325) * 'kPa';
#	l_source.Outlet.T = (40 + 273.15) * 'K';
#	l_source.Outlet.BSW = 0.0;
#	l_source.Outlet.ws = 0.0;
#	l_source.Outlet.d60 = 0.915883;
#	l_source.Outlet.Tbn = 692.092 * 'K';
#	l_source.Outlet.dg = 1.47012;
#	l_source.Outlet.Ycg = 8.39605*'l/m^3';
	
#	valv.c = 1.0;
#	valv.Outlet.P = (700+101.325) * 'kPa';

	EQUATIONS
#	bal*'m^3/s' = l_source.Outlet.Qf*(1-l_source.Outlet.BSW)*l_source.Outlet.Rs 
#		- l_sink.Inlet.Qf*(1-l_sink.Inlet.BSW)*(l_sink.Inlet.Rs + l_sink.Inlet.Rgo);

	bal*'m^3/s' = l_source.Outlet.Qf*(1-l_source.Outlet.BSW)*l_source.Outlet.Rs 
		- l_sink.Inlet.Qf*(1-l_sink.Inlet.BSW)*l_sink.Inlet.Rs - l_sink.Inlet.Qg;

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_valv_liq_ctrl
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	
	DEVICES
	l_source 		as liquid_source;
	l_sink		as triphase_sink;
	FV			as valv_liq_ctrl;
	FIT			as volflow_transmitter;
	FIC			as PID_pos;

	CONNECTIONS
	l_source.Outlet		to	FV.Inlet;
	l_source.Outlet.Qf		to	FIT.PVinput;
	FV.Outlet				to 	l_sink.Inlet;
	FIT.PVoutput			to	FIC.PV;
	FIT.SPoutput			to	FIC.SP;
	FIC.MVoutput			to	FV.MVinput;
	
	SET
	FV.Cv = 2000*'gal/min';
	FV.tau = 10*'s';
	
	FIT.RangeMax = 30000*'m^3/d';
	FIT.RangeMin = 0*'m^3/d';
	FIC.action = "Reverse";	
	
	SPECIFY
	l_source.Outlet.P = (700+101.325) * 'kPa';
	l_source.Outlet.T = (90 + 273.15) * 'K';
	l_source.Outlet.BSW = 0.2;
	l_source.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	l_source.Outlet.d60 = 141.5/(30+131.5);
	l_source.Outlet.Tbn = (11.3*l_source.Outlet.d60)^3 * 'degR';
	l_source.Outlet.dg = 1.05;
	l_source.Outlet.Ycg = 5.5*'l/m^3';

	FIT.SPinput = 22000*'m^3/d';
	FIC.KC = 1;
	FIC.TI = FV.tau;
	FIC.TD = 0*'min';

	FV.Outlet.P = (200+101.325) * 'kPa';

	EQUATIONS
	"Controller mode Auto to Man"
#	FIC.mode = 0;
	FIC.mode = 0.5*(1+tanh((time/'s'-240)/1e-5));
	
	"Output controller tracking (Auto Mode) to User defined manipulated variable (Man Mode)"
#	FIC.MVinput = FIC.MVoutput;
	FIC.MVinput = FIC.MVoutput*0.5*(1+tanh((240-time/'s')/1e-5)) 
		+ 0.6*0.5*(1+tanh((time/'s'-240)/1e-5));

	INITIAL
	FV.c = 0.8;
	FIC.MVoutput = FV.c;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 600;
	TimeUnit='s';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_valv_cond
	DEVICES
	c_source 		as condensate_source;
	valv			as valv_liq;
	c_sink		as biphase_sink;

	CONNECTIONS
	c_source.Outlet	to	valv.Inlet;
	valv.Outlet		to	c_sink.Inlet;
	
	SET
#	valv.Cv = 1000*'gal/min';
	valv.Cv = 60*'gal/min';

	valv.FL = 0.91;
	
	SPECIFY
	c_source.Outlet.P = (2000+101.325) * 'kPa';
	c_source.Outlet.T = (40 + 273.15) * 'K';
	c_source.Outlet.d60 = 141.5/(45+131.5);
	c_source.Outlet.Tbn = (10.5*c_source.Outlet.d60)^3 * 'degR';
	c_source.Outlet.dg = 0.9;
	c_source.Outlet.Ycg = 4*'l/m^3';
	
	valv.c = 0.8;
	valv.Outlet.P = (700+101.325) * 'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_valv_cond_ctrl
	DEVICES
	c_source 		as condensate_source;
	c_sink		as biphase_sink;
	FV			as valv_liq_ctrl;
	FIT			as volflow_transmitter;
	FIC			as PID_pos;

	CONNECTIONS
	c_source.Outlet		to	FV.Inlet;
	c_source.Outlet.Qf		to	FIT.PVinput;
	FV.Outlet				to 	c_sink.Inlet;
	FIT.PVoutput			to	FIC.PV;
	FIT.SPoutput			to	FIC.SP;
	FIC.MVoutput			to	FV.MVinput;
	
	SET
	FV.Cv = 1000*'gal/min';
	FV.tau = 10*'s';
	
	FIT.RangeMax = 30000*'m^3/d';
	FIT.RangeMin = 0*'m^3/d';
	FIC.action = "Reverse";	
	
	SPECIFY
	c_source.Outlet.P = (700+101.325) * 'kPa';
	c_source.Outlet.T = (90 + 273.15) * 'K';
	c_source.Outlet.d60 = 141.5/(30+131.5);
	c_source.Outlet.Tbn = (11.3*c_source.Outlet.d60)^3 * 'degR';
	c_source.Outlet.dg = 1.05;
	c_source.Outlet.Ycg = 5.5*'l/m^3';

	FIT.SPinput = 22000*'m^3/d';
	FIC.KC = 1;
	FIC.TI = FV.tau;
	FIC.TD = 0*'min';

	FV.Outlet.P = (200+101.325) * 'kPa';

	EQUATIONS
	"Controller mode Auto to Man"
#	FIC.mode = 0;
	FIC.mode = 0.5*(1+tanh((time/'s'-240)/1e-5));
	
	"Output controller tracking (Auto Mode) to User defined manipulated variable (Man Mode)"
#	FIC.MVinput = FIC.MVoutput;
	FIC.MVinput = FIC.MVoutput*0.5*(1+tanh((240-time/'s')/1e-5)) 
		+ 0.6*0.5*(1+tanh((time/'s'-240)/1e-6));

	INITIAL
	FV.c = 0.8;
	FIC.MVoutput = FV.c;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 600;
	TimeUnit='s';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_valv_gas
	DEVICES
	g_source 		as gas_source;
	g_sink		as gas_sink;
	valv			as valv_gas;

	CONNECTIONS
	g_source.Outlet	to	valv.Inlet;
	valv.Outlet 		to	g_sink.Inlet;
	
	SET
#	valv.Cv = 120*'gal/min';
#	valv.Cv = 500*'gal/min';
	valv.Cv = 120*'gal/min';

	valv.Fgamma = 0.8;
	valv.xT = 0.7;

	SPECIFY
#	g_source.Outlet.P = (700+101.325) * 'kPa';
#	g_source.Outlet.T = (90 + 273.15) * 'K';
#	g_source.Outlet.d60G = 141.5/(30+131.5);
#	g_source.Outlet.TbnG = (11.8*g_source.Outlet.d60)^3 * 'degR';
#	g_source.Outlet.dg = 1.05;
#	g_source.Outlet.Ycg = 5.5*'l/m^3';

#	valv.c = 1.0;
#	g_source.Outlet.Qg = 88000*'m^3/d';
#	valv.Outlet.P = (600+101.325) * 'kPa';

#	g_source.Outlet.P = (2000+101.325) * 'kPa';
#	g_source.Outlet.T = (40 + 273.15) * 'K';
#	g_source.Outlet.d60G = 0.736195;
#	g_source.Outlet.TbnG = 186.673 * 'K';
#	g_source.Outlet.dg = 0.727155;
#	g_source.Outlet.Ycg = 4.15287*'l/m^3';

#	valv.c = 1.0;
#	g_source.Outlet.Qg = 4.06398e6*'m^3/d';
#	valv.Outlet.P = 101.325 * 'kPa';

	g_source.Outlet.P = (25000+101.325) * 'kPa';
	g_source.Outlet.T = (40 + 273.15) * 'K';
	g_source.Outlet.d60G = 141.5/(50+131.5);
	g_source.Outlet.TbnG = (120+273.15) * 'K';
	g_source.Outlet.dg = 0.7;
	g_source.Outlet.Ycg = 4*'l/m^3';

	valv.c = 1.0;
#	g_source.Outlet.Qg = 4*'m^3/d';
	valv.Outlet.P = (20000+101.325) * 'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_valv_gas_ctrl
	DEVICES
	g_source 		as gas_source;
	g_sink		as gas_sink;
	FV			as valv_gas_ctrl;
	FIT			as volflow_transmitter;
	FIC			as PID_pos;
	
	CONNECTIONS
	g_source.Outlet		to	FV.Inlet;
	FV.Outlet 			to	g_sink.Inlet;
	g_source.Outlet.Qg		to	FIT.PVinput;
	FIT.PVoutput			to	FIC.PV;
	FIT.SPoutput			to	FIC.SP;
	FIC.MVoutput 			to	FV.MVinput;

	SET
#	FV.Cv = 210*'gal/min';
	FV.Cv = 120*'gal/min';
	FV.tau = 10*'s';
	
	FIT.RangeMax = 2.5e5*'m^3/d';
	FIT.RangeMin = 0*'m^3/d';
	FIC.action = "Reverse";
	
	SPECIFY
#	g_source.Outlet.P = (8000+101.325) * 'kPa';
#	g_source.Outlet.T = (40 + 273.15) * 'K';
#	g_source.Outlet.d60G = 141.5/(70+131.5);
#	g_source.Outlet.TbnG = (8.65*g_source.Outlet.d60G)^3 * 'degR';
#	g_source.Outlet.dg = 0.65;
#	g_source.Outlet.Ycg = 2.4*'l/m^3';

	g_source.Outlet.P = (700+101.325) * 'kPa';
	g_source.Outlet.T = (90 + 273.15) * 'K';
	g_source.Outlet.d60G = 141.5/(30+131.5);
	g_source.Outlet.TbnG = (11.8*g_source.Outlet.d60G)^3 * 'degR';
	g_source.Outlet.dg = 1.05;
	g_source.Outlet.Ycg = 5.5*'l/m^3';

#	FIT.SPinput = 3e6*'m^3/d';
	FIT.SPinput = 88e3*'m^3/d';
	FIC.KC = 1;
	FIC.TI = FV.tau;
	FIC.TD = 0*'min';

#	FV.Outlet.P = (5000+101.325) * 'kPa';
	FV.Outlet.P = (600+101.325) * 'kPa';

	EQUATIONS
	"Controller mode Auto to Man"
	FIC.mode = 0.5*(1+tanh((time/'s'-240)/1e-5));
	
	"Output controller tracking (Auto Mode) to User defined manipulated variable (Man Mode)"
	FIC.MVinput = FIC.MVoutput*0.5*(1+tanh((240-time/'s')/1e-5)) 
		+ 0.6*0.5*(1+tanh((time/'s'-240)/1e-5));
	
	INITIAL
	FV.c = 0.8;
	FIC.MVoutput = FV.c;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 600;
	TimeUnit='s';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_valv_gasliq
	DEVICES
	gl_source 	as gasliq_source;
	gl_sink		as gasliq_sink;
	valv			as valv_gas;

	CONNECTIONS
	gl_source.Outlet	to	valv.Inlet;
	valv.Outlet 		to	gl_sink.Inlet;
	
	SET
	valv.Cv = 420*'gal/min';
#	valv.Cv = 120*'gal/min';
	
	SPECIFY
	gl_source.Outlet.P = (8000+101.325) * 'kPa';
	gl_source.Outlet.T = (25 + 273.15) * 'K';
	gl_source.Rcg = 0.35 * 'l/m^3';
	gl_source.Outlet.d60G = 141.5/(70+131.5);
	gl_source.Outlet.TbnG = (8.65*gl_source.Outlet.d60G)^3 * 'degR';
	gl_source.Outlet.dg = 0.65;
	gl_source.Outlet.Ycg = 2.4*'l/m^3';

#	g_source.Outlet.P = (700+101.325) * 'kPa';
#	g_source.Outlet.T = (90 + 273.15) * 'K';
#	g_source.Rcg = 0 * 'l/m^3';
#	g_source.Outlet.d60G = 141.5/(30+131.5);
#	g_source.Outlet.TbnG = (11.8*g_source.Outlet.d60G)^3 * 'degR';
#	g_source.Outlet.dg = 1.05;
#	g_source.Outlet.Ycg = 5.5*'l/m^3';

#	g_source.Outlet.Qg = 3e6*'m^3/d';
	valv.Outlet.P = (5000+101.325) * 'kPa';
#	g_source.Outlet.Qg = 88000*'m^3/d';
#	valv.Outlet.P = (600+101.325) * 'kPa';

	valv.c = 0.5;
	
	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_valv_gasliq_ctrl
	DEVICES
	gl_source 	as gasliq_source;
	gl_sink		as gasliq_sink;
	FV			as valv_gas_ctrl;
	FIT			as volflow_transmitter;
	FIC			as PID_pos;
	
	CONNECTIONS
	gl_source.Outlet		to	FV.Inlet;
	FV.Outlet 			to	gl_sink.Inlet;
	gl_source.Outlet.Qg		to	FIT.PVinput;
	FIT.PVoutput			to	FIC.PV;
	FIT.SPoutput			to	FIC.SP;
	FIC.MVoutput 			to	FV.MVinput;

	SET
#	FV.Cv = 210*'gal/min';
	FV.Cv = 120*'gal/min';
	FV.tau = 10*'s';
	
	FIT.RangeMax = 2.5e5*'m^3/d';
#	FIT.RangeMax = 6e6*'m^3/d';
	FIT.RangeMin = 0*'m^3/d';
	FIC.action = "Reverse";
	
	SPECIFY
#	gl_source.Outlet.P = (8000+101.325) * 'kPa';
#	gl_source.Outlet.T = (25 + 273.15) * 'K';
#	gl_source.Rcg = 0.05 * 'l/m^3';
#	gl_source.Outlet.d60G = 141.5/(70+131.5);
#	gl_source.Outlet.TbnG = (8.65*gl_source.Outlet.d60G)^3 * 'degR';
#	gl_source.Outlet.dg = 0.65;
#	gl_source.Outlet.Ycg = 2.4*'l/m^3';

	gl_source.Outlet.P = (700+101.325) * 'kPa';
	gl_source.Outlet.T = (90 + 273.15) * 'K';
	gl_source.Rcg = 0 * 'l/m^3';
	gl_source.Outlet.d60G = 141.5/(30+131.5);
	gl_source.Outlet.TbnG = (11.8*gl_source.Outlet.d60G)^3 * 'degR';
	gl_source.Outlet.dg = 1.05;
	gl_source.Outlet.Ycg = 5.5*'l/m^3';

#	FIT.SPinput = 3e6*'m^3/d';
	FIT.SPinput = 88e3*'m^3/d';
	FIC.KC = 1;
	FIC.TI = FV.tau;
	FIC.TD = 0*'min';

#	FV.Outlet.P = (5000+101.325) * 'kPa';
	FV.Outlet.P = (600+101.325) * 'kPa';

	EQUATIONS
	"Controller mode Auto to Man"
	FIC.mode = 0.5*(1+tanh((time/'s'-240)/1e-5));
	
	"Output controller tracking (Auto Mode) to User defined manipulated variable (Man Mode)"
	FIC.MVinput = FIC.MVoutput*0.5*(1+tanh((240-time/'s')/1e-5)) 
		+ 0.6*0.5*(1+tanh((time/'s'-240)/1e-5));
	
	INITIAL
	FV.c = 0.8;
	FIC.MVoutput = FV.c;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 600;
	TimeUnit='s';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_mixer_3ph
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);	
	
	DEVICES
	str3ph_1 		as triphase_source;
	str3ph_2 		as triphase_source;
	str3ph_3		as triphase_source;
	mix			as mixer_3ph;
	triph_sink	as triphase_sink;

	SET
	mix.numOfInlets = 3;

	CONNECTIONS
	str3ph_1.Outlet	to	mix.Inlet(1);
	str3ph_2.Outlet	to	mix.Inlet(2);
	str3ph_3.Outlet	to	mix.Inlet(3);
	mix.Outlet		to	triph_sink.Inlet;
	
	SPECIFY
	str3ph_1.Outlet.Qf = 10000 * 'm^3/d';
	str3ph_1.Outlet.T = (70 + 273.15) * 'K';
	str3ph_1.Outlet.BSW = 0.1;
	str3ph_1.Rgo = 200*'m^3/m^3';
	str3ph_1.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	str3ph_1.Outlet.d60 = 141.5/(30+131.5);
	str3ph_1.Outlet.Tbn = (11.3*str3ph_1.Outlet.d60)^3 * 'degR';
	str3ph_1.Outlet.dg = 0.8;
	str3ph_1.Outlet.Ycg = 0.35*'l/m^3';
	
	str3ph_2.Outlet.Qf = 5000 * 'm^3/d';
	str3ph_2.Outlet.T = (90 + 273.15) * 'K';
	str3ph_2.Outlet.BSW = 0.5;
	str3ph_2.Rgo = 100*'m^3/m^3';
	str3ph_2.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	str3ph_2.Outlet.d60 = 141.5/(28+131.5);
	str3ph_2.Outlet.Tbn = (10.8*str3ph_2.Outlet.d60)^3 * 'degR';
	str3ph_2.Outlet.dg = 0.7;
	str3ph_2.Outlet.Ycg = 0.25*'l/m^3';
	
	str3ph_3.Outlet.Qf = 22000 * 'm^3/d';
	str3ph_3.Outlet.T = (15 + 273.15) * 'K';
	str3ph_3.Outlet.BSW = 0.005;
	str3ph_3.Rgo = 200*'m^3/m^3';
	str3ph_3.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	str3ph_3.Outlet.d60 = 141.5/(35+131.5);
	str3ph_3.Outlet.Tbn = (11.5*str3ph_3.Outlet.d60)^3 * 'degR';
	str3ph_3.Outlet.dg = 0.7;
	str3ph_3.Outlet.Ycg = 0.55*'l/m^3';
	
	mix.Outlet.P = 1000 * 'kPa';
#	str3ph_1.Outlet.P = 1000*'kPa';
#	str3ph_2.Outlet.P = 1000*'kPa';
#	str3ph_3.Outlet.P = 1000*'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_mixer_gas
	DEVICES
	strG_1 		as gas_source;
	strG_2 		as gas_source;
	strG_3 		as gas_source;
	mix			as mixer_gas;
	g_sink		as gas_sink;

	SET
	mix.numOfInlets = 3;

	CONNECTIONS
	strG_1.Outlet		to	mix.Inlet(1);
	strG_2.Outlet		to	mix.Inlet(2);
	strG_3.Outlet		to	mix.Inlet(3);
	mix.Outlet		to	g_sink.Inlet;
	
	SPECIFY
	strG_1.Outlet.Qg = 5e4 * 'm^3/d';
	strG_1.Outlet.T = (90 + 273.15) * 'K';
	strG_1.Outlet.d60G = 141.5/(45+131.5);
	strG_1.Outlet.TbnG = (10.9*strG_1.Outlet.d60G)^3*'degR';
	strG_1.Outlet.dg = 1.5;
	strG_1.Outlet.Ycg = 6.5*'l/m^3';

	strG_2.Outlet.Qg = 1.5e5 * 'm^3/d';
	strG_2.Outlet.T = (90 + 273.15) * 'K';
	strG_2.Outlet.d60G = 141.5/(50+131.5);
	strG_2.Outlet.TbnG = (10.5*strG_2.Outlet.d60G)^3*'degR';
	strG_2.Outlet.dg = 1.05;
	strG_2.Outlet.Ycg = 5.5*'l/m^3';
	
	strG_3.Outlet.Qg = 5e5 * 'm^3/d';
	strG_3.Outlet.T = (0 + 273.15) * 'K';
	strG_3.Outlet.d60G = 141.5/(70+131.5);
	strG_3.Outlet.TbnG = (8.65*strG_3.Outlet.d60G)^3*'degR';
	strG_3.Outlet.dg = 0.65;
	strG_3.Outlet.Ycg = 2.4*'l/m^3';
	
	mix.Outlet.P = 700 * 'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_mixer3_gas
	DEVICES
	strG_1 		as gas_source;
	strG_2 		as gas_source;
	strG_3 		as gas_source;
	mix			as mixer3_gas;
	g_sink		as gas_sink;

	CONNECTIONS
	strG_1.Outlet		to	mix.Inlet1;
	strG_2.Outlet		to	mix.Inlet2;
	strG_3.Outlet		to	mix.Inlet3;
	mix.Outlet		to	g_sink.Inlet;
	
	SPECIFY
	strG_1.Outlet.Qg = 1.5e5 * 'm^3/d';
	strG_1.Outlet.T = (110 + 273.15) * 'K';
	strG_1.Outlet.d60G = 141.5/(40+131.5);
	strG_1.Outlet.TbnG = (10.9*strG_1.Outlet.d60G)^3*'degR';
	strG_1.Outlet.dg = 1.5;
	strG_1.Outlet.Ycg = 6.5*'l/m^3';

	strG_2.Outlet.Qg = 2.5e5 * 'm^3/d';
	strG_2.Outlet.T = (130 + 273.15) * 'K';
	strG_2.Outlet.d60G = 141.5/(45+131.5);
	strG_2.Outlet.TbnG = (10.9*strG_2.Outlet.d60G)^3*'degR';
	strG_2.Outlet.dg = 1.2;
	strG_2.Outlet.Ycg = 6.0*'l/m^3';
	
	strG_3.Outlet.Qg = 5e5 * 'm^3/d';
	strG_3.Outlet.T = (90 + 273.15) * 'K';
	strG_3.Outlet.d60G = 141.5/(50+131.5);
	strG_3.Outlet.TbnG = (10.5*strG_3.Outlet.d60G)^3*'degR';
	strG_3.Outlet.dg = 1.05;
	strG_3.Outlet.Ycg = 5.5*'l/m^3';
	
	mix.Outlet.P = 2000 * 'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_mixer_water
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);	
	
	DEVICES
	strW_1 		as water_source;
	strW_2 		as water_source;
	mix			as mixer_water;
	w_sink		as water_sink;

	SET
	mix.numOfInlets = 2;

	CONNECTIONS
	strW_1.Outlet		to	mix.Inlet(1);
	strW_2.Outlet		to	mix.Inlet(2);
	mix.Outlet		to	w_sink.Inlet;
	
	SPECIFY
	strW_1.Outlet.Qw = 10000 * 'm^3/d';
	strW_1.Outlet.T = (90 + 273.15) * 'K';
	strW_1.Outlet.TOG = 1000 * 'ml/m^3';
	strW_1.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	strW_1.Outlet.d60 = 141.5/(30+131.5);
	strW_1.Outlet.Tbn = (11.3*strW_1.Outlet.d60)^3 * 'degR';
	
	strW_2.Outlet.Qw = 1000 * 'm^3/d';
	strW_2.Outlet.T = (90 + 273.15) * 'K';
	strW_2.Outlet.TOG = 100 * 'ml/m^3';
	strW_2.Outlet.ws = (50*'g/l'/rho_H2Ostd)/(1 + (50*'g/l'/rho_H2Ostd));
	strW_2.Outlet.d60 = 141.5/(30+131.5);
	strW_2.Outlet.Tbn = (11.3*strW_1.Outlet.d60)^3 * 'degR';
	
	mix.Outlet.P = 101.325 * 'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_mixer_W3ph
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);	
	
	DEVICES
	str3ph_1		as triphase_source;
	strw_1		as water_source;
	mixRFW		as mixer_W3ph;
	triph_sink	as triphase_sink;

	SET
	mixRFW.numOfInletsF = 1;
	mixRFW.numOfInletsW = 1;

	CONNECTIONS
	str3ph_1.Outlet	to	mixRFW.InletF;
	strw_1.Outlet		to	mixRFW.InletW;
	mixRFW.Outlet		to	triph_sink.Inlet;
	
	SPECIFY
	str3ph_1.Outlet.Qf = 22000 * 'm^3/d';
	str3ph_1.Outlet.T = (15 + 273.15) * 'K';
	str3ph_1.Outlet.BSW = 0.005;
	str3ph_1.Rgo = 200*'m^3/m^3';
	str3ph_1.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	str3ph_1.Outlet.d60 = 141.5/(30+131.5);
	str3ph_1.Outlet.Tbn = (11.3*str3ph_1.Outlet.d60)^3 * 'degR';
	str3ph_1.Outlet.dg = 0.8;
	str3ph_1.Outlet.Ycg = 0.35*'l/m^3';
	
	strw_1.Outlet.Qw = 1200 * 'm^3/d';
	strw_1.Outlet.T = (90 + 273.15) * 'K';
	strw_1.Outlet.ws = 0;
	strw_1.Outlet.TOG = 1000 * 'ml/m^3';
	strw_1.Outlet.d60 = 141.5/(30+131.5);
	strw_1.Outlet.Tbn = (11.3*strw_1.Outlet.d60)^3 * 'degR';

	mixRFW.Outlet.P = 2000 * 'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_pump
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	
	DEVICES
	l_str 		as liquid_source;
	l_sink		as liquid_sink;
	B_001		as pump_liq;
	
	w_str 		as water_source;
	B_002		as pump_water;
	triph_source	as triphase_source;
	mixRFW		as mixer_W3ph;

	CONNECTIONS
	l_str.Outlet		to	B_001.Inlet;
	B_001.Outlet 		to	l_sink.Inlet;
	
	w_str.Outlet		to	B_002.Inlet;
	B_002.Outlet 		to	mixRFW.InletW;
	triph_source.Outlet	to  mixRFW.InletF;
	
	SET
	mixRFW.numOfInletsF = 1;
	mixRFW.numOfInletsW = 1;

	B_001.A = 9e-4*'h^2/m^5';
	B_001.h0 = 220*'m';
	
	B_002.A = 9e-4*'h^2/m^5';
	B_002.h0 = 220*'m';
	
	SPECIFY
#	l_str.Outlet.Qf = 300 * 'm^3/h';
	l_str.Outlet.P = (700+101.325)*'kPa';
	l_str.Outlet.T = (40 + 273.15)*'K';
	l_str.Outlet.BSW = 0.25;
	l_str.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	l_str.Outlet.d60 = 141.5/(29+131.5);
	l_str.Outlet.Tbn = (13*l_str.Outlet.d60)^3 * 'degR';
	l_str.Outlet.dg = 0.7;
	l_str.Outlet.Ycg = 0.25*'l/m^3';
	
	B_001.Outlet.P = (2000+101.325)*'kPa';
	
#	w_str.Outlet.Qf = 300 * 'm^3/h';
	w_str.Outlet.P = (700+101.325)*'kPa';
	w_str.Outlet.T = (90 + 273.15)*'K';
	w_str.Outlet.TOG = 2000*'ml/m^3';
	w_str.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	w_str.Outlet.d60 = 141.5/(29+131.5);
	w_str.Outlet.Tbn = (13*w_str.Outlet.d60)^3 * 'degR';
	
#	B_002.Outlet.P = (2000+101.325)*'kPa';
	
	triph_source.Outlet.P = 2000 * 'kPa';
	triph_source.Outlet.Qf = 22000 * 'm^3/d';
	triph_source.Outlet.T = (15 + 273.15) * 'K';
	triph_source.Outlet.BSW = 0;
	triph_source.Rgo = 200*'m^3/m^3';
	triph_source.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	triph_source.Outlet.d60 = 141.5/(30+131.5);
	triph_source.Outlet.Tbn = (13*triph_source.Outlet.d60)^3 * 'degR';
	triph_source.Outlet.dg = 0.8;
	triph_source.Outlet.Ycg = 0.35*'l/m^3';
	
	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_heater_cooler_liq
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	
	DEVICES
	str2heat 		as triphase_source;
	str2cool 		as triphase_source;
	
	heat			as heater_liq;
	cool			as cooler_liq;

	CONNECTIONS
	str2heat.Outlet	to	heat.Inlet;
	str2cool.Outlet	to	cool.Inlet;
	
	SET
#	heat.Cf = 250*'cm^2';
#	cool.Cf = 200*'cm^2';

	SPECIFY
	str2heat.Outlet.P = (800+101.325)*'kPa';
	str2heat.Outlet.Qf = 22000 * 'm^3/d';
	str2heat.Outlet.T = (40+273.15) * 'K';
	str2heat.Outlet.BSW = 0.20;
	str2heat.Rgo = 0*'m^3/m^3';
	str2heat.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	str2heat.Outlet.d60 = 141.5/(29+131.5);
	str2heat.Outlet.Tbn = (11.3*str2heat.Outlet.d60)^3 * 'degR';
	str2heat.Outlet.dg = 0.7;
	str2heat.Outlet.Ycg = 0.25*'l/m^3';

#	heat.Outlet.P = (700+101.325)*'kPa';
	heat.Outlet.T = (40+273.15)*'K';
#	heat.Outlet.Rs = 1*'m^3/m^3';
#	heat.Qin = 0*'MW';
	heat.DP = 120*'kPa';

	str2cool.Outlet.P = (200+101.325)*'kPa';
	str2cool.Outlet.Qf = 16000 * 'm^3/d';
	str2cool.Outlet.T = (90 + 273.15) * 'K';
	str2cool.Outlet.BSW = 0.005;
	str2cool.Rgo = 0*'m^3/m^3';
	str2cool.Outlet.ws = 0;
	str2cool.Outlet.d60 = 141.5/(29+131.5);
	str2cool.Outlet.Tbn = (11.3*str2cool.Outlet.d60)^3 * 'degR';
	str2cool.Outlet.dg = 0.7;
	str2cool.Outlet.Ycg = 0.25*'l/m^3';

#	cool.Outlet.P = (100+101.325)*'kPa';
	cool.Outlet.T = (55+273.15)*'K';
#	cool.Qout = 22.5*'MW';
	cool.DP = 120*'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_hexch_liq
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	
	DEVICES
	hot 			as triphase_source;
	cold 		as triphase_source;	
	hex			as hexch_liq;

	CONNECTIONS
	cold.Outlet	to	hex.Cold.Inlet;
	cold.Outlet	to	hex.ColdMax.Inlet;
	hot.Outlet	to	hex.Hot.Inlet;
	hot.Outlet	to	hex.HotMax.Inlet;
	
	SET
#	hex.HotSide.Cf = 250*'cm^2';
#	hex.ColdSide.Cf = 200*'cm^2';
#	hex.A = 210*'m^2';
	hex.UA = 1600*'kW/K';

	SPECIFY
	cold.Outlet.P = (700+101.325)*'kPa';
	cold.Outlet.Qf = 20000 * 'm^3/d';
	cold.Outlet.T = (40 + 273.15) * 'K';
	cold.Outlet.BSW = 0.20;
	cold.Rgo = 5*'m^3/m^3';
	cold.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	cold.Outlet.d60 = 141.5/(29+131.5);
	cold.Outlet.Tbn = (10.5*cold.Outlet.d60)^3 * 'degR';
	cold.Outlet.dg = 0.7;
	cold.Outlet.Ycg = 0.25*'l/m^3';
	
	hot.Outlet.P = (200+101.325)*'kPa';
	hot.Outlet.Qf = 16000 * 'm^3/d';
	hot.Outlet.T = (90 + 273.15) * 'K';
	hot.Outlet.BSW = 0.005;
	hot.Rgo = 0*'m^3/m^3';
	hot.Outlet.ws = (35*'g/l'/rho_H2Ostd)/(1 + (35*'g/l'/rho_H2Ostd));
	hot.Outlet.d60 = 141.5/(29+131.5);
	hot.Outlet.Tbn = (10.5*hot.Outlet.d60)^3 * 'degR';
	hot.Outlet.dg = 0.7;
	hot.Outlet.Ycg = 0.25*'l/m^3';

#	hex.ColdSide.Outlet.P = (700+101.325)*'kPa';
#	hex.HotSide.Outlet.P = (100+101.325)*'kPa';
	hex.Hot.DP = 120*'kPa';
	hex.Cold.DP = 120*'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_heater_cooler_gasliq
	DEVICES
	gas2heat 		as gasliq_source;
	gas2cool 		as gasliq_source;
	
	heat			as heater_gasliq;
	cool			as cooler_gasliq;

	CONNECTIONS
	gas2heat.Outlet	to	heat.Inlet;
	gas2cool.Outlet	to	cool.Inlet;
	
	SET
	heat.Cf = 35*'cm^2';
	cool.Cf = 180*'cm^2';

	SPECIFY
	gas2heat.Outlet.P = (4000+101.325)*'kPa';
	gas2heat.Outlet.Qg = 5e5 * 'm^3/d';
	gas2heat.Rcg = 0 * 'l/m^3';
	gas2heat.Outlet.T = (40+273.15) * 'K';
	gas2heat.Outlet.d60G = 141.5/(70+131.5);
	gas2heat.Outlet.TbnG = (10.5*gas2heat.Outlet.d60G)^3 * 'degR';
	gas2heat.Outlet.dg = 0.65;
	gas2heat.Outlet.Ycg = 2.4*'l/m^3';

#	heat.Outlet.P = (700+101.325)*'kPa';
	heat.Outlet.T = (80+273.15)*'K';
#	heat.Outlet.Rs = 1*'m^3/m^3';
#	heat.Qin = 42.5*'MW';
#	heat.DP = 70*'kPa';

	gas2cool.Outlet.P = (8000+101.325)*'kPa';
	gas2cool.Outlet.Qg = 3e6 * 'm^3/d';
	gas2cool.Rcg = 0 * 'l/m^3';
	gas2cool.Outlet.T = (140 + 273.15) * 'K';
	gas2cool.Outlet.d60G = 141.5/(70+131.5);
	gas2cool.Outlet.TbnG = (10.5*gas2cool.Outlet.d60G)^3 * 'degR';
	gas2cool.Outlet.dg = 0.65;
	gas2cool.Outlet.Ycg = 2.4*'l/m^3';

#	cool.Outlet.P = (100+101.325)*'kPa';
	cool.Outlet.T = (40+273.15)*'K';
#	cool.Qout = 22.5*'MW';
#	cool.DP = 70*'kPa';

	OPTIONS
	Dynamic=true;
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
end

FlowSheet test_hexch_gasliq
	DEVICES
	hot 		as gasliq_source;
	cold 	as gasliq_source;	
	hex		as hexch_gasliq;

	CONNECTIONS
	cold.Outlet	to	hex.Cold.Inlet;
	cold.Outlet	to	hex.ColdMax.Inlet;
	hot.Outlet	to	hex.Hot.Inlet;
	hot.Outlet	to	hex.HotMax.Inlet;
	
	SET
	hex.Hot.Cf = 150*'cm^2';
	hex.Cold.Cf = 180*'cm^2';
	hex.UA = 400*'kW/K';

	SPECIFY
	cold.Outlet.P = (5000+101.325)*'kPa';
	cold.Outlet.Qg = 6e6 * 'm^3/d';
	cold.Rcg = 0 * 'l/m^3';
	cold.Outlet.T = (10+273.15) * 'K';
	cold.Outlet.d60G = 141.5/(70+131.5);
	cold.Outlet.TbnG = (10.5*cold.Outlet.d60G)^3 * 'degR';
	cold.Outlet.dg = 0.65;
	cold.Outlet.Ycg = 2.4*'l/m^3';

	hot.Outlet.P = (8000+101.325)*'kPa';
	hot.Outlet.Qg = 6e6 * 'm^3/d';
	hot.Rcg = 0 * 'l/m^3';
	hot.Outlet.T = (40+273.15) * 'K';
	hot.Outlet.d60G = 141.5/(70+131.5);
	hot.Outlet.TbnG = (10.5*hot.Outlet.d60G)^3 * 'degR';
	hot.Outlet.dg = 0.65;
	hot.Outlet.Ycg = 2.4*'l/m^3';

#	hex.Cold.DP = 70*'kPa'; 
#	hex.Hot.DP = 70*'kPa'; 

	OPTIONS
	Dynamic = true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 60;
	TimeUnit = 's';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_hexch_hliq_cgas
	DEVICES
	hot 		as gasliq_source;
	cold 	as condensate_source;
#	cold 	as triphase_source;
	valv		as valv_liq;
	hex		as hexch_hliq_cgas;

	CONNECTIONS
	cold.Outlet			to	valv.Inlet;
	valv.Outlet			to	hex.Cold.Inlet;
	valv.Outlet			to	hex.ColdMax.Inlet;
	hot.Outlet			to	hex.Hot.Inlet;
	hot.Outlet			to	hex.HotMax.Inlet;
	
	SET
	valv.Cv = 15*'gal/min';
	valv.FL = 0.91;
	
	hex.Hot.Cf = 150*'cm^2';
	hex.UA = 400*'kW/K';

	SPECIFY
	cold.Outlet.P = (5000+101.325)*'kPa';
#	cold.Outlet.P = (700+101.325)*'kPa';
#	cold.Outlet.Qf = 1000 * 'm^3/d';
#	cold.Outlet.BSW = 0;
#	cold.Outlet.ws = 0;
#	cold.Rgo = 0 * 'm^3/m^3';
	cold.Outlet.T = (10 + 273.15) * 'K';
	cold.Outlet.d60G = 141.5/(45+131.5);
	cold.Outlet.TbnG = (10.5*cold.Outlet.d60G)^3 * 'degR';
	cold.Outlet.dg = 0.65;
	cold.Outlet.Ycg = 2.4*'l/m^3';

	hot.Outlet.P = (8000+101.325)*'kPa';
	hot.Outlet.Qg = 6e6 * 'm^3/d';
	hot.Rcg = 0 * 'l/m^3';
	hot.Outlet.T = (40+273.15) * 'K';
	hot.Outlet.d60G = 141.5/(70+131.5);
	hot.Outlet.TbnG = (10.5*hot.Outlet.d60G)^3 * 'degR';
	hot.Outlet.dg = 0.65;
	hot.Outlet.Ycg = 2.4*'l/m^3';

#	hex.Hot.Outlet.T = (30 + 273.15)*'K';

	hex.Cold.DP = 70*'kPa';
#	hex.Hot.DP = 70*'kPa';
	valv.c = 1.0;
	valv.Outlet.P = (700+101.325)*'kPa';

	OPTIONS
	Dynamic = true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 60;
	TimeUnit = 's';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end


FlowSheet test_compressor
	DEVICES
	gas 		as gas_source;
	comp 	as compressor;

	CONNECTIONS
	gas.Outlet	to	comp.Inlet;
	
	SET
	comp.effM = 0.95;
	comp.CpCv = 1.2;
	comp.a2 = 0.35;
	comp.a3 = 1.3;
	comp.a4 = 0.8;
	comp.p0 = 0.35;
	comp.p1 = 0.36;
	comp.p2 = 0.6;
	
	SPECIFY
	gas.Outlet.P = (2000+101.325)*'kPa';
	gas.Outlet.Qg = 3e6 * 'm^3/d';
	gas.Outlet.T = (40 + 273.15) * 'K';
	gas.Outlet.d60G = 141.5/(29+131.5);
	gas.Outlet.TbnG = (10.5*gas.Outlet.d60G)^3 * 'degR';
	gas.Outlet.dg = 0.7;
	gas.Outlet.Ycg = 0.25*'l/m^3';

	comp.Outlet.P = (8000+101.325)*'kPa';

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 600;
	TimeUnit='s';
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_degasser_ctrl
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	gas			as gas_sink;
	liq			as triphase_sink;

	V_TO_001 		as degasser;
	
	PIT_002		as pressure_transmitter;
	PIC_002		as PID_pos;
	PV_002		as valv_gas_ctrl;
	
	LIT_003		as level_transmitter;
	LIC_003		as PID_pos;
	LV_003		as valv_liq_ctrl;
	
	CONNECTIONS
	feed.Outlet			to V_TO_001.Inlet;
	
	V_TO_001.OutletG		to PV_002.Inlet;
	PV_002.Outlet			to gas.Inlet;
	
	V_TO_001.OutletL 		to LV_003.Inlet;
	LV_003.Outlet			to liq.Inlet;
	
	V_TO_001.OutletG.P		to PIT_002.PVinput;
	PIT_002.PVoutput		to PIC_002.PV;
	PIT_002.SPoutput		to PIC_002.SP;
	PIC_002.MVoutput 		to PV_002.MVinput;

	V_TO_001.Level			to LIT_003.PVinput;
	LIT_003.PVoutput		to LIC_003.PV;
	LIT_003.SPoutput		to LIC_003.SP;
	LIC_003.MVoutput 		to LV_003.MVinput;
	
	SET
#DEGASSER PARAMETERS
	V_TO_001.L = 8 * 'm';
	V_TO_001.D = 2.5 * 'm';

#DEGASSER PRESSURE CONTROLLER
	PIT_002.RangeMax = 1500*'kPa';
	PIT_002.RangeMin = 0*'kPa';
	PIC_002.action = "Direct";	

#DEGASSER PRESSURE FINAL ELEMENT
	PV_002.Cv = 120 * 'gal/min';
	PV_002.Fgamma = 0.8;
	PV_002.xT = 0.7;

#DEGASSER LIQUID LEVEL CONTROLLER
	LIT_003.RangeMax = 2.5*'m';
	LIT_003.RangeMin = 0*'m';
	LIC_003.action = "Direct";

#DEGASSER LIQUID LEVEL FINAL ELEMENT
#	LV_003.Cv = 1000 * 'gal/min';
	LV_003.Cv = 1800 * 'gal/min';
	LV_003.FL = 0.91;

	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.Qf = 22000 * 'm^3/d';
	feed.Outlet.BSW = 0.20;
	feed.Rgo = 5 * 'm^3/m^3';
	feed.Outlet.T = (90+273.15) * 'K';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.API = 30;
	feed.Kw = 11.8;
	feed.Outlet.dg = 1.05;
	feed.Outlet.Ycg = 5.5*'l/m^3';
	
#DEGASSER PRESSURE CONTROLLER
	PIT_002.SPinput = 700*'kPa' + Patm;
	PIC_002.KC = 4;
	PIC_002.TI = 160*'s';
	PIC_002.TD = 0*'s';
	PIC_002.mode = 0; #Auto
	PIC_002.MVinput = PIC_002.MVoutput;

#DEGASSER LEVEL CONTROLLER
	LIT_003.SPinput = 1.0*'m';
	LIC_003.KC = 4;
	LIC_003.TI = 60*'s';
	LIC_003.TD = 0*'s';
	LIC_003.mode = 0; #Auto
	LIC_003.MVinput = LIC_003.MVoutput;

#SPECIAL CONDIDTIONS
	gas.Inlet.P = 600*'kPa' + Patm;
	liq.Inlet.P = 200*'kPa' + Patm;
#	PV_002.Outlet.P = 600*'kPa' + Patm;
#	LV_003.Outlet.P = 200*'kPa' + Patm;

	EQUATIONS
#	feed.Outlet.T = (90+273.15)*'K' * 
#		(1 - 0.1*0.5*(1+tanh((time/'min'-60)/1e-6)));

	INITIAL
	"Degasser initial conditions"
	V_TO_001.OutletG.P = 700*'kPa' + Patm;
	V_TO_001.OutletG.T = (80+273.15)*'K';
	V_TO_001.OutletL.BSW = 0.15;
	V_TO_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	V_TO_001.OutletL.d60 = 141.5/(35+131.5);
	V_TO_001.OutletL.Tbn = (12.1*V_TO_001.OutletL.d60)^3*'degR';
	V_TO_001.OutletG.dg = 0.95;
	V_TO_001.OutletG.Ycg = 4.5*'l/m^3';
	V_TO_001.Level = 1.5*'m';
	
	PV_002.c = 0.2;
#	PV_002.Outlet.Qg = 2.5e5*'m^3/d';
	PIC_002.MVoutput = PV_002.c;

	LV_003.c = 0.7;
#	LV_003.Outlet.Qf = 20000*'m^3/d';
	LIC_003.MVoutput = LV_003.c;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 120;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_triseparator_ctrl
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	
	SG_001 		as triphase_separator;
	
	FE_001		as valv_gas;
	FIT_001		as volflow_transmitter;
	
	LIT_001		as level_transmitter;
	LIC_001		as PID_pos;
	LV_001		as valv_liq_ctrl;
	
	LIT_002		as level_transmitter;
	LIC_002		as PID_pos;
	LV_002		as valv_water_ctrl;
	
	CONNECTIONS
	feed.Outlet			to SG_001.Inlet;
	
	SG_001.OutletG			to FE_001.Inlet;
	SG_001.OutletL 		to LV_001.Inlet;
	SG_001.OutletW 		to LV_002.Inlet;
	
	FE_001.Outlet.Qg		to FIT_001.PVinput;

	SG_001.LevelCL			to LIT_001.PVinput;
	LIT_001.PVoutput		to LIC_001.PV;
	LIT_001.SPoutput		to LIC_001.SP;
	LIC_001.MVoutput 		to LV_001.MVinput;

	SG_001.LevelWCS		to LIT_002.PVinput;
	LIT_002.PVoutput		to LIC_002.PV;
	LIT_002.SPoutput		to LIC_002.SP;
	LIC_002.MVoutput 		to LV_002.MVinput;
	
	SET
#TRISEPARATOR PARAMETERS
	SG_001.hweir = 2.5 * 'm';
	SG_001.LCS = 16.0 * 'm';
	SG_001.LCL = 4.0 * 'm';
	SG_001.D = 5.0 * 'm';

#TRISEPARATOR GAS STD. VOL. FLOW TRANSMITTER
	FIT_001.RangeMax = 6e6*'m^3/d';
	FIT_001.RangeMin = 0*'m^3/d';

#TRISEPARATOR GAS STD. VOL. FLOW ELEMENT
	FE_001.Cv = 1500 * 'gal/min';
	FE_001.Fgamma = 0.8;
	FE_001.xT = 0.7;

#TRISEPARATOR OIL LEVEL CONTROLLER
	LIT_001.RangeMax = 3*'m';
	LIT_001.RangeMin = 0*'m';
	LIC_001.action = "Direct";

#TRISEPARATOR OIL LEVEL FINAL ELEMENT
#	LV_001.Cv = 650 * 'gal/min';
	LV_001.Cv = 900 * 'gal/min';
	LV_001.FL = 0.91;

#TRISEPARATOR WATER LEVEL CONTROLLER
	LIT_002.RangeMax = 3*'m';
	LIT_002.RangeMin = 0*'m';
	LIC_002.action = "Direct";
	
#TRISEPARATOR WATER LEVEL FINAL ELEMENT
	LV_002.Cv = 500 * 'gal/min';
	LV_002.FL = 0.91;

	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.T = (40+273.15) * 'K';
	feed.Outlet.BSW = 0.20;
	feed.Rgo = 200 * 'm^3/m^3';
	feed.Cws = 255*'g/l';
	feed.API = 29;
	feed.Kw = 11.3;
	feed.Outlet.dg = 0.7;
	feed.Outlet.Ycg = 4*'l/m^3';
	
#TRISEPARATOR GAS STD. VOL. FLOW TRANSMITTER AND INSTRUMENT
	FE_001.c = 1.0;
	FIT_001.SPinput = 6e6*'m^3/d';

#TRISEPARATOR OIL LEVEL CONTROLLER
#	LIT_001.SPinput = 1.5*'m';
	LIC_001.KC = 1;
	LIC_001.TI = 600*'s';
	LIC_001.TD = 0*'s';
	LIC_001.mode = 0; #Auto
	LIC_001.MVinput = LIC_001.MVoutput;

#TRISEPARATOR WATER LEVEL CONTROLLER
	LIC_002.KC = 4;
	LIC_002.TI = 600*'s';
	LIC_002.TD = 0*'s';
	LIC_002.mode = 0; #Auto
	LIC_002.MVinput = LIC_002.MVoutput;

#SPECIAL CONDIDTIONS
	FE_001.Outlet.P = 1900*'kPa' + Patm;
	LV_001.Outlet.P = 700*'kPa' + Patm;
	LV_002.Outlet.P = 700*'kPa' + Patm;

	EQUATIONS
	"Feed liquid std vol. flow step disturb"
	feed.Outlet.Qf = 24000*'m^3/d';
#	feed.Outlet.Qf = 24000*'m^3/d'*(1-0.1*0.5*(1+tanh((time/'min'-180)/1e-6)));

	"Water level set-point step disturb"
	LIT_002.SPinput = 0.75*'m';
#	LIT_002.SPinput = 0.75*'m' + 0.5*'m'*0.5*(1+tanh((time/'min'-180)/1e-6));

	"Oil level set-point step disturb"
#	LIT_001.SPinput = 1.5*'m';
#	LIT_001.SPinput = 1.5*'m' + 1.25*'m'*0.5*(1+tanh((time/'min'-60)/1e-6));
	LIT_001.SPinput = 1.5*'m' 
		+ 1.25*'m'*0.5*(1+tanh((time/'min'-60)/1e-6))
		- 1.25*'m'*0.5*(1+tanh((time/'min'-180)/1e-6));

	INITIAL
	"Triseparator initial conditions"
	SG_001.OutletG.P = 2000* 'kPa' + Patm;
	SG_001.OutletG.T = (25+273.15)*'K';
	SG_001.OutletL.d60 = 141.5/(29+131.5);
	SG_001.OutletL.Tbn = (11.3*SG_001.OutletL.d60)^3*'degR';
	SG_001.OutletG.dg = 0.7;
	SG_001.OutletG.Ycg = 4*'l/m^3';
	SG_001.OutletW.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	SG_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	SG_001.BSWLCS = 0.05;
	SG_001.OutletL.BSW = 0.05;
	SG_001.LevelWCS = 0.50*'m';
	SG_001.LevelCS = 1.001*SG_001.hweir;
	SG_001.LevelCL = 1.0*'m';

	LV_001.c = 0.5;
#	LV_001.Outlet.Qf = 24000*'m^3/d';
	LIC_001.MVoutput = LV_001.c;

	LV_002.c = 0.5;
#	LV_002.Outlet.Qw = 8400*'m^3/d';
	LIC_002.MVoutput = LV_002.c;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 600;
	TimeUnit='min';
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_degasser_heater_liq
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	gas			as gas_sink;
	liq			as triphase_sink;

	P_002		as heater_liq;
	TIT_001		as temperature_transmitter;
	TIC_001		as PID_pos;

	V_TO_001		as degasser;
	
	PIT_002		as pressure_transmitter;
	PIC_002		as PID_pos;
	PV_002		as valv_gas_ctrl;

	LIT_003		as level_transmitter;
	LIC_003		as PID_pos;
	LV_003		as valv_liq_ctrl;
	
	CONNECTIONS
	feed.Outlet			to P_002.Inlet;
	
	P_002.Outlet			to V_TO_001.Inlet;
	
	V_TO_001.OutletG		to PV_002.Inlet;
	PV_002.Outlet			to gas.Inlet;	
	
	V_TO_001.OutletL		to LV_003.Inlet;
	LV_003.Outlet			to liq.Inlet;

	P_002.Outlet.T			to TIT_001.PVinput;
	TIT_001.PVoutput		to TIC_001.PV;
	TIT_001.SPoutput		to TIC_001.SP;
	
	V_TO_001.OutletG.P		to PIT_002.PVinput;
	PIT_002.PVoutput		to PIC_002.PV;
	PIT_002.SPoutput		to PIC_002.SP;
	PIC_002.MVoutput 		to PV_002.MVinput;

	V_TO_001.Level			to LIT_003.PVinput;
	LIT_003.PVoutput		to LIC_003.PV;
	LIT_003.SPoutput		to LIC_003.SP;
	LIC_003.MVoutput 		to LV_003.MVinput;
	
	SET
#HEATER TEMPERATURE CONTROLLER
	TIT_001.RangeMax = (120+273.15)*'K';
	TIT_001.RangeMax = (0+273.15)*'K';
	TIC_001.action = "Reverse";

#DEGASSER PARAMETERS
	V_TO_001.L = 8 * 'm';
	V_TO_001.D = 2.5 * 'm';

#DEGASSER PRESSURE CONTROLLER
	PIT_002.RangeMax = 1500*'kPa';
	PIT_002.RangeMin = 0*'kPa';
	PIC_002.action = "Direct";	

#DEGASSER PRESSURE FINAL ELEMENT
	PV_002.Cv = 120 * 'gal/min';
	PV_002.Fgamma = 0.8;
	PV_002.xT = 0.7;

#LIQUID LEVEL CONTROLLER
	LIT_003.RangeMax = 2.5*'m';
	LIT_003.RangeMin = 0*'m';
	LIC_003.action = "Direct";

#LIQUID LEVEL FINAL ELEMENT
#	LV_003.Cv = 1000 * 'gal/min';
	LV_003.Cv = 1800 * 'gal/min';
	LV_003.FL = 0.91;
	
	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.Qf = 22000 * 'm^3/d';
	feed.Outlet.BSW = 0.20;
	feed.Rgo = 5 * 'm^3/m^3';
	feed.Outlet.T = (65+273.15) * 'K';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.API = 30;
	feed.Kw = 11.8;
	feed.Outlet.dg = 1.05;
	feed.Outlet.Ycg = 5.5*'l/m^3';

#HEATER SPECIFICATIONS
	P_002.DP = 120*'kPa';
	P_002.Qin = (50*'MW')*TIC_001.MVoutput;

#HEATER TEMPERATURE SPECIFICATIONS
	TIT_001.SPinput = (90+273.15)*'K';
	TIC_001.KC = 1;
	TIC_001.TI = 60*'s';
	TIC_001.TD = 0*'s';
	TIC_001.mode = 0; #Auto
	TIC_001.MVinput = TIC_001.MVoutput;

#DEGASSER PRESSURE CONTROLLER
	PIT_002.SPinput = 700*'kPa' + Patm;
	PIC_002.KC = 4;
	PIC_002.TI = 60*'s';
	PIC_002.TD = 0*'s';
	PIC_002.mode = 0; #Auto
	PIC_002.MVinput = PIC_002.MVoutput;

#OIL LEVEL CONTROLLER
	LIT_003.SPinput = 1.0*'m';
	LIC_003.KC = 4;
	LIC_003.TI = 160*'s';
	LIC_003.TD = 0*'s';
	LIC_003.mode = 0; #Auto
	LIC_003.MVinput = LIC_003.MVoutput;

#SPECIAL CONDIDTIONS
	gas.Inlet.P = 600*'kPa' + Patm;
	liq.Inlet.P = 200*'kPa' + Patm;
	
	EQUATIONS
#	feed.Outlet.T = (90+273.15)*'K' * 
#		(1 - 0.1*0.5*(1+tanh((time/'min'-60)/1e-6)));	

	INITIAL
	"Heater initial conditions"
	P_002.Qin = 10*'MW';
#	P_001.Outlet.T = (90+273.15)*'K';

	"Degasser initial conditions"
	V_TO_001.OutletG.P = 700*'kPa' + Patm;
	V_TO_001.OutletG.T = (90+273.15)*'K';
	V_TO_001.OutletL.d60 = 141.5/(29+131.5);
	V_TO_001.OutletL.Tbn = (11.3*feed.Outlet.d60)^3*'degR';
	V_TO_001.OutletG.dg = 0.7;
	V_TO_001.OutletG.Ycg = 4*'l/m^3';
	V_TO_001.Level = 1*'m';
	V_TO_001.OutletL.BSW = 0.2;
	V_TO_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	
	PV_002.c = 0.2;
	PIC_002.MVoutput = PV_002.c;

	LV_003.c = 0.7;
	LIC_003.MVoutput = LV_003.c;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 120;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet test_oil_treater_heater_liq
	PARAMETERS
	rho_H2Ostd	as dens_mass	(Brief="Pure water mass density at std. cond.",Default=999.054);
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed 		as triphase_source;
	gas			as gas_sink;
	liq			as triphase_sink;
	water		as water_sink;

	P_002		as heater_liq;	
	TIT_001		as temperature_transmitter;
	TIC_001		as PID_pos;
	
	V_TO_001		as degasser;
	TO_001		as oil_treater;

	PIT_002		as pressure_transmitter;
	PIC_002		as PID_pos;
	PV_002		as valv_gas_ctrl;

	LIT_003		as level_transmitter;
	LIC_003		as PID_pos;
	LV_003		as valv_liq_ctrl;

	LIT_004		as level_transmitter;
	LIC_004		as PID_pos;
	LV_004		as valv_water_ctrl;
	
	CONNECTIONS
	feed.Outlet			to P_002.Inlet;
	PV_002.Outlet			to gas.Inlet;
	LV_003.Outlet			to liq.Inlet;
	LV_004.Outlet			to water.Inlet;

	P_002.Outlet			to V_TO_001.Inlet;
	V_TO_001.OutletL		to TO_001.Inlet;
	V_TO_001.OutletG		to PV_002.Inlet;

	P_002.Outlet.T			to TIT_001.PVinput;
	TIT_001.PVoutput		to TIC_001.PV;
	TIT_001.SPoutput		to TIC_001.SP;

	TO_001.OutletL			to LV_003.Inlet;
	TO_001.OutletW 		to LV_004.Inlet;

	V_TO_001.OutletG.P		to PIT_002.PVinput;
	PIT_002.PVoutput		to PIC_002.PV;
	PIT_002.SPoutput		to PIC_002.SP;
	PIC_002.MVoutput 		to PV_002.MVinput;

	V_TO_001.Level			to LIT_003.PVinput;
	LIT_003.PVoutput		to LIC_003.PV;
	LIT_003.SPoutput		to LIC_003.SP;
	LIC_003.MVoutput 		to LV_003.MVinput;

	TO_001.LevelW			to LIT_004.PVinput;
	LIT_004.PVoutput		to LIC_004.PV;
	LIT_004.SPoutput		to LIC_004.SP;
	LIC_004.MVoutput 		to LV_004.MVinput;
	
	SET
#HEATER TEMPERATURE CONTROLLER
	TIT_001.RangeMax = (120+273.15)*'K';
	TIT_001.RangeMax = (0+273.15)*'K';
	TIC_001.action = "Reverse";

#DEGASSER PARAMETERS
	V_TO_001.L = 8 * 'm';
	V_TO_001.D = 2.5 * 'm';
	
#OIL TREATER PARAMETERS
	TO_001.L = 15.0 * 'm';
	TO_001.D = 4.0 * 'm';
	TO_001.TRL50 = 210*'s';
	TO_001.b = 3.6;

#DEGASSER PRESSURE CONTROLLER
	PIT_002.RangeMax = 1500*'kPa';
	PIT_002.RangeMin = 0*'kPa';
	PIC_002.action = "Direct";	

#DEGASSER PRESSURE FINAL ELEMENT
	PV_002.Cv = 120 * 'gal/min';
	PV_002.Fgamma = 0.8;
	PV_002.xT = 0.7;

#DEGASSER OIL LEVEL CONTROLLER
	LIT_003.RangeMax = 2.5*'m';
	LIT_003.RangeMin = 0*'m';
	LIC_003.action = "Direct";

#DEGASSER OIL LEVEL FINAL ELEMENT
#	LV_003.Cv = 1000 * 'gal/min';
	LV_003.Cv = 1800 * 'gal/min';
	LV_003.FL = 0.91;

#OIL TREATER WATER LEVEL CONTROLLER
	LIT_004.RangeMax = 4*'m';
	LIT_004.RangeMin = 0*'m';
	LIC_004.action = "Direct";
	
#OIL TREATER WATER LEVEL FINAL ELEMENT
	LV_004.Cv = 240 * 'gal/min';
	LV_004.FL = 0.91;
	
	SPECIFY
#FEED CONDIDTIONS
	feed.Outlet.Qf = 22000 * 'm^3/d';
	feed.Outlet.BSW = 0.20;
	feed.Rgo = 5 * 'm^3/m^3';
	feed.Outlet.T = (65+273.15) * 'K';
	feed.Outlet.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	feed.API = 30;
	feed.Kw = 11.8;
	feed.Outlet.dg = 1.05;
	feed.Outlet.Ycg = 5.5*'l/m^3';

#HEATER SPECIFICATIONS
	P_002.DP = 120*'kPa';
	P_002.Qin = (50*'MW')*TIC_001.MVoutput;

#HEATER TEMPERATURE CONTROLLER
	TIT_001.SPinput = (90+273.15)*'K';
	TIC_001.KC = 1;
	TIC_001.TI = 60*'s';
	TIC_001.TD = 0*'s';
	TIC_001.mode = 0; #Auto
	TIC_001.MVinput = TIC_001.MVoutput;

#DEGASSER PRESSURE CONTROLLER
	PIT_002.SPinput = 700*'kPa' + Patm;
	PIC_002.KC = 4;
	PIC_002.TI = 60*'s';
	PIC_002.TD = 0*'s';
	PIC_002.mode = 0; #Auto
	PIC_002.MVinput = PIC_002.MVoutput;

#DEGASSER OIL LEVEL CONTROLLER
	LIT_003.SPinput = 1.0*'m';
	LIC_003.KC = 4;
	LIC_003.TI = 160*'s';
	LIC_003.TD = 0*'s';
	LIC_003.mode = 0; #Auto
	LIC_003.MVinput = LIC_003.MVoutput;

#OIL TREATER WATER LEVEL CONTROLLER
	LIT_004.SPinput = 2.0*'m';
	LIC_004.KC = 4;
	LIC_004.TI = 600*'s';
	LIC_004.TD = 0*'s';
	LIC_004.mode = 0; #Auto
	LIC_004.MVinput = LIC_004.MVoutput;

#SPECIAL CONDIDTIONS
	gas.Inlet.P = 600*'kPa' + Patm;
	liq.Inlet.P = 100*'kPa' + Patm;
	water.Inlet.P = 100*'kPa' + Patm;
	
	INITIAL
	"Heater initial conditions"
	P_002.Qin = 10*'MW';

	"Degasser initial conditions"
	V_TO_001.OutletG.P = 700*'kPa' + Patm;
	V_TO_001.OutletG.T = (90+273.15)*'K';
	V_TO_001.OutletL.BSW = 0.05;
	V_TO_001.OutletL.d60 = 141.5/(29+131.5);
	V_TO_001.OutletL.Tbn = (11.3*V_TO_001.OutletL.d60)^3 * 'degR';
	V_TO_001.OutletG.dg = 0.7;
	V_TO_001.OutletG.Ycg = 4*'l/m^3';
	V_TO_001.Level = 1*'m';
	V_TO_001.OutletL.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));

	"Oil-treater initial conditions"	
	TO_001.OutletW.T = (90+273.15)*'K';
	TO_001.OutletL.d60 = 141.5/(29+131.5);
	TO_001.OutletL.Tbn = (11.3*TO_001.OutletL.d60)^3 * 'degR';
	TO_001.OutletW.ws = (255*'g/l'/rho_H2Ostd)/(1 + (255*'g/l'/rho_H2Ostd));
	TO_001.LevelW = 2*'m';
	
	PV_002.c = 0.5;
	PIC_002.MVoutput = PV_002.c;

	LV_003.c = 0.5;
	LIC_003.MVoutput = LV_003.c;

	LV_004.c = 0.5;
	LIC_004.MVoutput = LV_004.c;
	
	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 180;
	TimeUnit='min';
	NLASolver(
		File="sundials",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end

FlowSheet UGKO
	PARAMETERS
	Patm			as pressure	(Brief="Atmospheric pressure",DisplayUnit='kPa',Default=1);
	
	DEVICES
	feed(2)			as strG;
	mix 			as mixer_gas;
	cool			as cooler_gasliq;
	sep				as gasliq_separator;
	gas				as gas_sink;
	liq				as condensate_sink;

	TIT				as temperature_transmitter;
	TIC				as PID_pos;

	PIT				as pressure_transmitter;
	PIC				as PID_pos;
	
	LIT				as level_transmitter;
	LIC				as PID_pos;

	SET
	mix.numOfInlets = 2;

	CONNECTIONS
	feed(1)			to mix.Inlet(1);
	feed(2)			to mix.Inlet(2);
	mix.Outlet 		to cool.Inlet;
	cool.Outlet		to sep.Inlet;
	sep.OutletG		to gas.Inlet;
	sep.OutletL		to liq.Inlet;

	cool.Outlet.T	to TIT.PVinput;
	TIT.PVoutput	to TIC.PV;
	TIT.SPoutput	to TIC.SP;

	sep.OutletG.P	to PIT.PVinput;
	PIT.PVoutput	to PIC.PV;
	PIT.SPoutput	to PIC.SP;

	sep.Level		to LIT.PVinput;
	LIT.PVoutput	to LIC.PV;
	LIT.SPoutput	to LIC.SP;

	SET	
#SCRUBBER PARAMETERS
	sep.H = 3 * 'm';
	sep.D = 1.25 * 'm';	

#TEMPERATURE CONTROLLER
	TIT.RangeMax = (100+273.15)*'K';
	TIT.RangeMin = (0+273.15)*'K';
	TIC.action = "Direct";

#PRESSURE CONTROLLER
	PIT.RangeMax = 3000*'kPa';
	PIT.RangeMin = 0*'kPa';
	PIC.action = "Direct";	

#LIQUID LEVEL CONTROLLER
	LIT.RangeMax = 3*'m';
	LIT.RangeMin = 0*'m';
	LIC.action = "Direct";
	
	SPECIFY
#feed(1) STREAM CONDIDTIONS (from UOTR_init002.rlt --> UOTR.FE_001.Outlet)
	feed(1).Qg 		= 5.41821e6 * 'm^3/d';
	feed(1).T 		= 307.708 * 'K';
	feed(1).hG		= 316.587 * 'kJ/kg';
	feed(1).rhoG 	= 16.8924 * 'kg/m^3';
	feed(1).Rv 		= 0.332803 * 'l/m^3';
	feed(1).Bg 		= 0.0475321 * 'm^3/m^3';
	feed(1).d60G 	= 0.775174;
	feed(1).TbnG 	= 373.389 * 'K';
	feed(1).dg 		= 0.655926;
	feed(1).Ycg 	= 6.0547 * 'l/m^3';

#feed(2) STREAM CONDIDTIONS (from UVRC_init002.rlt --> UVRC.SPT(2).Outlet2)
	feed(2).Qg 		= 133964 * 'm^3/d';
	feed(2).T 		= 369.452 * 'K';
	feed(2).hG		= 240.827 * 'kJ/kg';
	feed(2).rhoG 	= 39.4868 * 'kg/m^3';
	feed(2).Rv 		= 1.24011 * 'l/m^3';
	feed(2).Bg 		= 0.0485643 * 'm^3/m^3';
	feed(2).d60G	= 0.821585;
	feed(2).TbnG 	= 447.528 * 'K';
	feed(2).dg 		= 1.56655;
	feed(2).Ycg 	= 13.6337 * 'l/m^3';

#TEMPERATURE CONTROLLER
	TIT.SPinput = (30+273.15)*'K';
	TIC.KC = 0.01;
	TIC.TI = 1*'s';
	TIC.TD = 0*'s';
	TIC.mode = 0; #Auto
	TIC.MVinput = TIC.MVoutput;

#PRESSURE CONTROLLER
	PIT.SPinput = 2000*'kPa' + Patm;
	PIC.KC = 4;
	PIC.TI = 600*'s';
	PIC.TD = 0*'s';
	PIC.mode = 0; #Auto
	PIC.MVinput = PIC.MVoutput;

#LEVEL CONTROLLER
	LIT.SPinput = 0.75 *'m';
	LIC.KC = 4;
	LIC.TI = 600*'s';
	LIC.TD = 0*'s';
	LIC.mode = 0; #Auto
	LIC.MVinput = LIC.MVoutput;
	
	EQUATIONS
#SPECIAL CONDIDTIONS
	cool.Qout/'MW' = 1 + (10-1)*TIC.MVoutput;
	gas.Inlet.Qg = PIC.MVoutput*1e7*'m^3/d';
	liq.Inlet.Qf = LIC.MVoutput*1000*'m^3/d';

	INITIAL
	sep.OutletG.P = 2000 * 'kPa' + Patm;
	sep.OutletG.T = (40+273.15) * 'K';
	sep.Level = 0.75 * 'm';
	sep.OutletG.dg = 0.65;
	sep.OutletG.Ycg	= 2 * 'l/m^3';
	sep.OutletG.d60G = 141.5/(70+131.5);
	sep.OutletG.TbnG = (9.083*sep.OutletG.d60G)^3 * 'degR';

	TIC.MVoutput = 0.5;
	PIC.MVoutput = 0.5;
	LIC.MVoutput = 0.5;

	OPTIONS
	Dynamic=true;
	TimeStart = 0;
	TimeStep = 1;
	TimeEnd = 120*60;
	TimeUnit='s';
	NLASolver(
		File="nlasolver",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8,
		MaxIterations=300
	);
	DAESolver(
		File="dasslc",
		RelativeAccuracy=1e-5,
		AbsoluteAccuracy=1e-8
	);
end
